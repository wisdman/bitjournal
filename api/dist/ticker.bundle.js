#!/usr/bin/env node
(function(e){var n={};function t(r){if(n[r]){return n[r].exports}var a=n[r]={i:r,l:false,exports:{}};e[r].call(a.exports,a,a.exports,t);a.l=true;return a.exports}t.m=e;t.c=n;t.d=function(e,n,r){if(!t.o(e,n)){Object.defineProperty(e,n,{configurable:false,enumerable:true,get:r})}};t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};t.d(n,'a',n);return n};t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};t.p='';return t(t.s=64)})([function(e,t,n){'use strict';var r=n(14),a=n.n(r),i=r.randomBytes;const s=['00','01','02','03','04','05','06','07','08','09','0a','0b','0c','0d','0e','0f','10','11','12','13','14','15','16','17','18','19','1a','1b','1c','1d','1e','1f','20','21','22','23','24','25','26','27','28','29','2a','2b','2c','2d','2e','2f','30','31','32','33','34','35','36','37','38','39','3a','3b','3c','3d','3e','3f','40','41','42','43','44','45','46','47','48','49','4a','4b','4c','4d','4e','4f','50','51','52','53','54','55','56','57','58','59','5a','5b','5c','5d','5e','5f','60','61','62','63','64','65','66','67','68','69','6a','6b','6c','6d','6e','6f','70','71','72','73','74','75','76','77','78','79','7a','7b','7c','7d','7e','7f','80','81','82','83','84','85','86','87','88','89','8a','8b','8c','8d','8e','8f','90','91','92','93','94','95','96','97','98','99','9a','9b','9c','9d','9e','9f','a0','a1','a2','a3','a4','a5','a6','a7','a8','a9','aa','ab','ac','ad','ae','af','b0','b1','b2','b3','b4','b5','b6','b7','b8','b9','ba','bb','bc','bd','be','bf','c0','c1','c2','c3','c4','c5','c6','c7','c8','c9','ca','cb','cc','cd','ce','cf','d0','d1','d2','d3','d4','d5','d6','d7','d8','d9','da','db','dc','dd','de','df','e0','e1','e2','e3','e4','e5','e6','e7','e8','e9','ea','eb','ec','ed','ee','ef','f0','f1','f2','f3','f4','f5','f6','f7','f8','f9','fa','fb','fc','fd','fe','ff'];var o=(e)=>s[e[0]]+s[e[1]]+s[e[2]]+s[e[3]]+'-'+s[e[4]]+s[e[5]]+'-'+s[e[6]]+s[e[7]]+'-'+s[e[8]]+s[e[9]]+'-'+s[e[10]]+s[e[11]]+s[e[12]]+s[e[13]]+s[e[14]]+s[e[15]];const d=i(16),u=[1|d[0],d[1],d[2],d[3],d[4],d[5]];let l=16383&(d[6]<<8|d[7]),p=0,c=0;var g=()=>{let e=new Date().getTime(),t=c+1,n=e-p+(t-c)/1e4,r=0>n?16383&l+1:l;if(0>n||e>p){t=0}if(1e4<=t)throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');p=e;c=t;l=r;e+=1.22192928e13;let a=0,i=new Uint8Array(16),s=(1e4*(268435455&e)+t)%4294967296;i[a++]=255&s>>>24;i[a++]=255&s>>>16;i[a++]=255&s>>>8;i[a++]=255&s;let d=268435455&1e4*(e/4294967296);i[a++]=255&d>>>8;i[a++]=255&d;i[a++]=16|15&d>>>24;i[a++]=255&d>>>16;i[a++]=128|r>>>8;i[a++]=255&r;for(let e=0;6>e;++e)i[a+e]=u[e];return o(i)};const m=/^[a-f0-9]{8}-[a-f0-9]{4}-1[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i,f=/^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i,y='00000000-0000-0000-0000-000000000000',b=/^00000000-0000-0000-0000-000000000000$/;class h{static getArray(e){return new Array().concat(e).map((e)=>{try{const t=new h(e&&e.id||e);return null===t.version?null:t}catch(e){return null}}).filter((e)=>null!==e)}constructor(e=null){if(e instanceof h){this.version=e.version;this.uuid=e.uuid;return this}if('string'===typeof e){let t=e.toLowerCase();if(b.test(t)){this.version=null;this.uuid=t;return this}if(m.test(t)){this.version=1;this.uuid=t;return this}if(f.test(t)){this.version=4;this.uuid=t;return this}throw new Error(`UUID "${e}" does not match the UUID string`)}if(null===e){this.version=null;this.uuid=y;return this}if(1===e){this.version=1;this.uuid=g();return this}if(4===e){this.version=4;this.uuid=g();return this}throw new Error(`Illegal UUID version of "${e}"`)}get value(){return this.uuid}valueOf(){return this.uuid}toNumber(){return NaN}toString(){return this.uuid}toJSON(){return this.uuid}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert UUID value to unknown value');}}[Symbol.toStringTag](){return'UUID'}}n.d(t,'a',function(){return h});n.d(t,false,function(){return'[a-f0-9]{8}-[a-f0-9]{4}-1[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}'});n.d(t,false,function(){return m});n.d(t,false,function(){return'[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}'});n.d(t,false,function(){return f});n.d(t,false,function(){return y});n.d(t,false,function(){return b})},function(e,t,n){'use strict';var o=Math.max,d=n(7),u=n.n(d);class l extends Error{constructor(e,t,n){if(t instanceof Error){n=t;t=n.message}if(n===undefined){n=new Error(t||'Unknown internal server error')}if(!t||500<=e){t=d.STATUS_CODES[e]||'Undefined error'}super(t);this.status=e;this.originError=n}}var p=n(11),c=n.n(p),g=n(29),m=n.n(g);class f{constructor(e,t){this.req=e;this.ctx=t}getHeader(e){let t=this.req.headers[e.toLowerCase()];return Array.isArray(t)?t.join(';'):t}get socket(){return this.req.socket}get ip(){return this.getHeader('X-Real-IP')||this.getHeader('X-Forwarded-For')||this.req.connection.remoteAddress||''}get host(){let e=this.getHeader('X-Forwarded-Host')||this.getHeader('Host');return e&&e.split(/\s*,\s*/)[0]||''}get hostname(){if(!this.host)return'';if('['===this.host[0]){let e=/^\[[a-f0-9:]+\]/.exec(this.host);return e&&e[0]||''}return this.host.split(':')[0]||''}get port(){let e=/\:([0-9]+)$/.exec(this.host);return e&&~~e[1]||80}get method(){return(this.req.method||'').toUpperCase()}get path(){return this.req.url||''}get pathname(){return(this.req.url||'').split('?')[0].split(/\/+/).filter((e)=>!!e)}get query(){let e=(this.req.url||'').split('?').slice(1).join('?');return Object(g.parse)(e)}get type(){let e=this.getHeader('Content-Type');if('string'!==typeof e)return;return e.split(';')[0].trim()}get length(){return~~(this.getHeader('content-length')||'')}async raw(){const e=this.length;return new Promise((t,n)=>{let r=Buffer.alloc(0);const a=()=>{u();n(new l(400,'Request aborted'))},i=()=>{u();n(new l(400,'Receive data error'))},s=(e)=>{r=Buffer.concat([r,e])},o=()=>{u();if(0<e&&r.length!==e){n(new l(400,'Request size did not match content length'))}t(r)},d=()=>{u()};var u=()=>{this.req.removeListener('aborted',a);this.req.removeListener('end',i);this.req.removeListener('data',s);this.req.removeListener('error',o);this.req.removeListener('close',d);this.req.unpipe()};this.req.on('aborted',a);this.req.on('error',i);this.req.on('data',s);this.req.on('end',o);this.req.on('close',d)})}async text(){let e=await this.raw();try{let t=new p.StringDecoder('utf8');return t.end(e)}catch(e){throw new l(400,'Receive data is not a UTF8 string',e)}}async json(){if('application/json'!==this.type){throw new l(400,'Only application/json data are allowed')}let e=await this.text();try{return JSON.parse(e)}catch(e){throw new l(400,'Invalid json received')}}valueOf(){return{heders:this.req.headers,ip:this.ip,host:this.host,hostname:this.hostname,port:this.port,method:this.method,path:this.path,pathname:this.pathname,query:this.query,type:this.type,length:this.length}}toJSON(){return this.valueOf()}}var y=n(12),b=n.n(y),h=[{mime:'image/jpeg',extension:'jpg',offset:0,header:new Uint8Array([255,216,255])},{mime:'image/png',extension:'png',offset:0,header:new Uint8Array([137,80,78,71,13,10,26,10])},{mime:'image/gif',extension:'gif',offset:0,header:new Uint8Array([71,73,70])},{mime:'image/webp',extension:'webp',offset:8,header:new Uint8Array([87,69,66,80])}];const w=/<!--([\s\S]*?)-->/g,v=/^\s*(?:<\?xml[^>]*>\s*)?(?:<!doctype svg[^>]*\s*(?:<![^>]*>)*[^>]*>\s*)?<svg[^>]*>[^]*<\/svg>\s*$/i,_=(e)=>{for(let t=0;24>t;t++)if(65533===e[t]||8>=e[t])return true;return false};var E=(e)=>!_(e)&&v.test(e.toString().replace(w,''));class O{constructor(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);if(1>=t.length)return this;for(let n of h)if(this.check(t,n.header,n.offset)){this.mime=n.mime;this.extension=n.extension;return this}if(E(t)){this.mime='image/svg+xml';this.extension='svg';return this}this.mime='application/octet-stream';this.extension=''}check(e,t,n=0){for(let r=0;r<t.length;r++)if(t[r]!==e[r+n])return false;return true}toJSON(){return{extension:this.extension,mime:this.mime}}toString(){return this.mime}[Symbol.toPrimitive](e){switch(e){case'number':throw new TypeError('Cannot convert a FileType value to a number value');case'string':case'default':return this.mime;default:throw new TypeError('Cannot convert a FileType value to unknown value');}}[Symbol.toStringTag](){return'FileType'}}class I{constructor(e,t){this.res=e;this.ctx=t;this.set(404)}get finished(){return this.res.finished}hasHeader(e){return this.res.hasHeader(e)}getHeader(e){let t=this.res.getHeader(e);return Array.isArray(t)?t.join(';'):t}setHeader(e,t){this.res.setHeader(e,t)}removeHeader(e){return this.res.removeHeader(e)}flushHeaders(){return this.res.flushHeaders()}get type(){let e=this.getHeader('Content-Type');if('string'!==typeof e)return;return e.split(';')[0].trim()}get length(){return~~(this.getHeader('Content-Length')||'')}get status(){return this.res.statusCode}get body(){return this._body}set(e,t){if(this.finished)return;if(this.res.headersSent)throw new Error('Headears was sended');if('number'!==typeof e){t=e;e=undefined}if(t===undefined||null===t){this.res.statusCode=e||404;this._body=d.STATUS_CODES[this.res.statusCode];this.removeHeader('Content-Type');this.removeHeader('Content-Length');this.removeHeader('Transfer-Encoding');return}if(null===t){this.res.statusCode=e||204;this._body=null;this.removeHeader('Content-Type');this.removeHeader('Content-Length');this.removeHeader('Transfer-Encoding');return}this.res.statusCode=e||200;if('string'===typeof t){this._body=t;this.setHeader('Content-Type',(/^\s*</.test(t)?'text/html':'text/plain')+'; charset=utf-8');this.setHeader('Content-Length',Buffer.byteLength(t));return}if(Buffer.isBuffer(t)){let e=new O(t);this._body=t;this.setHeader('Content-Type',e.mime||'application/octet-stream');this.setHeader('Content-Length',t.length);let n='inline';const r=Object(y.parse)(this.ctx.request.path);if(r.name){const t=e.extension||r.ext||'';if(t)n+=`; filename=${r.name}.${t}`}this.setHeader('Content-Disposition',n);return}if('object'===typeof t){let e=JSON.stringify(t);this._body=e;this.setHeader('Content-Type','application/json; charset=utf-8');this.setHeader('Content-Length',Buffer.byteLength(e));return}throw TypeError('Unknown response body type')}respond(){if(this.finished)return;if(null===this._body||this._body===undefined){this.res.end()}else{this.res.end(this._body)}}end(e,t){this.set(e,t);this.respond()}valueOf(){return{heders:this.res.getHeaders(),status:this.status,type:this.type,length:this.length,body:this.body}}toJSON(){return this.valueOf()}}var S=n(5),T=n.n(S);function r(e,t){if(!e.status||500<=e.status)console.error('\x1B[31m=== Internal context error ===\n',e,'\x1B[0m\n=== with Context ===\n',t===undefined?undefined:Object(S.inspect)(t.valueOf(),{depth:3,colors:true}))}class A{constructor(e,t){try{this.request=new f(e,this);this.response=new I(t,this)}catch(e){this.throw(e)}}get finished(){return this.response.finished}set(e,t){this.response.set(e,t)}respond(){this.response.respond()}end(e,t){this.response.end(e,t)}throw(e){if(e instanceof l)this.end(e.status,e.message);else this.end(500);r(e,this)}valueOf(){return{request:this.request.valueOf(),response:this.response.valueOf()}}toJSON(){return this.valueOf()}}function a(e){return async function(t,n=()=>Promise.resolve()){let r=-1;const a=(s)=>async()=>{if(s<=r){throw new Error('next() called multiple times')}r=s;if(s>=e.length){return await n()}await e[s].call(this,t,a(s+1))};await a(0)()}}class C extends Function{constructor(e){super('throw new TypeError("CallableClass was called")');return Object.setPrototypeOf(e,new.target.prototype)}}class j extends C{constructor(){super(async(e,t)=>await this.main(e,t))}async main(e,t){await t()}}class x extends Array{static get(e){return this.List.get(e)||new x}static set(e,t){this.List.set(e,t)}}x.List=new WeakMap;const D=/^\*+$/,R=/^\:+(.*)$/,P=/^[a-z][a-z0-9]*$/i,q=(e)=>e.replace(/([.+*?=^!:${}()[\]|/\\])/g,'\\$1');class k{constructor(e=''){this.keys=['*'];let t=e.split(/\s*\/\s*/).filter((e)=>e.length).map((e)=>{if(D.test(e))return'[^/]+';let t=R.exec(e);if(!t)return q(e);let n=t[1];if(!P.test(n))throw TypeError(`Key name "${n}" does not match "${P.source}" pattern`);this.keys.push(n);return'([^/]+)'}).join('(?:/+)');this.pattern=new RegExp('^(?:/+)?'+t+'(?:/+)?$')}exec(e=''){let t=this.pattern.exec(e);if(!t)return;return t.reduce((e,t,n)=>{e[this.keys[n]]=t;return e},{})}}function i(e,t,n,r){const a=new k(t);return async function(i,s){const o=i.route;if(!o)return await s();if(o.finished)return await s();if(o.method!==e||'HEAD'===o.method&&'GET'!==e)return await s();const d=a.exec(o.pathname);if(!d)return await s();for(let e of n)if(!(e in o.query))return await s();o.data=d;i.debug('=== Route %s [%s] ===\n%s %s => %s\nData: %s\nQuery: %s',o.method,o.path,t,n,r,o.data,o.query);await this[r](i,s)}}function s(e,t='',...n){return(r,a)=>{if('symbol'===typeof a)throw new TypeError('Property name must be a string');let s=x.get(r.constructor);s.push(i(e,t,n,a));x.set(r.constructor,s)}}const N=(e,...t)=>s('DELETE',e,...t),L=(e,...t)=>s('GET',e,...t),M=(e,...t)=>s('POST',e,...t),U=(e,...t)=>s('PUT',e,...t);class F{constructor(e){this.finished=false;this.data={};this.method=e.request.method;this.path=e.request.path;this.pathname='/'+e.request.pathname.join('/');this.query=e.request.query}valueOf(){return{method:this.method,path:this.path,pathname:this.pathname,query:this.query,finished:this.finished,data:this.data}}toJSON(){return this.valueOf()}}const Q=Symbol('Route');class $ extends j{constructor(e=F){super();this.BaseClass=e;this[Q]=a(x.get(this.constructor))}async main(e,t){e.route=new this.BaseClass(e);return this[Q].call(this,e,t)}}const H=process.env.SERVICE_HOSTNAME||'0.0.0.0',G=o(~~(process.env.SERVICE_PORT||'')||0,0)||80,V=o(~~(process.env.SERVICE_TIMEOUT||'')||0,0)||120,B=o(~~(process.env.SERVICE_KEEP_ALIVE||'')||0,0)||5,z=(process.env.NODE_DEBUG||'').split(/\s*,\s*/).map((e)=>e.toLowerCase().trim()).filter((e)=>!!e);class X extends j{constructor(){super(...arguments);this.enable=z.includes('service'.toLowerCase())}log(...e){let t=e.shift();e=e.map((e)=>Object(S.inspect)(e&&e.valueOf instanceof Function?e.valueOf():e,{depth:3,colors:true}));console.log(t,...e)}async main(e,t){e.debug=this.enable?(...e)=>this.log(...e):()=>undefined;e.debug('=== Input context ===\n%s',e);await t();e.debug('=== Output context ===\n%s',e)}}class W extends d.Server{constructor(...e){super();e.unshift(new X);const t=a(e.map((e)=>e));this.on('request',(e,n)=>{const a=new A(e,n);t(a,()=>Promise.resolve()).then(()=>a.respond()).catch((e)=>{r(e,a);try{a.throw(e)}catch(e){}})});this.on('clientError',(e,t)=>{t.end('HTTP/1.1 400 Bad Request\r\n\r\n');r(e)});this.timeout=V;this.keepAliveTimeout=B;this.listen(G,H,()=>{const e=this.address();console.log(`Opened HTTP server on ${e.address}:${e.port}`)})}}n.d(t,'a',function(){return A});n.d(t,false,function(){return f});n.d(t,false,function(){return I});n.d(t,false,function(){return l});n.d(t,false,function(){return a});n.d(t,'d',function(){return j});n.d(t,'b',function(){return N});n.d(t,'c',function(){return L});n.d(t,'e',function(){return M});n.d(t,'f',function(){return U});n.d(t,false,function(){return F});n.d(t,'g',function(){return $});n.d(t,'h',function(){return W})},function(e,t,n){'use strict';var r=Math.min,a=Math.max,i=n(0),s=n(4);const o=/^[a-z][a-z0-9]*$/;class d{constructor(e,t){this.id=e;this.value=t;if(!o.test(e))throw new TypeError(`Enum ID "${e}" does not matc the pattern "${o.source}"`)}static*[Symbol.iterator](){const e=Object.keys(this);for(let t of e){yield this[t]}}static get(e){let t=String(e&&e.id||e);for(let n of this)if(n.id===t)return n}static getArray(e){return new Array().concat(e).map((e)=>this.get(e)).filter((e)=>e!==undefined)}valueOf(){return this.id}toNumber(){return NaN}toString(){return this.value}toJSON(){return this.id}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Enum value to unknown value');}}[Symbol.toStringTag](){return'Enum'}}class u extends d{constructor(e,t,n){super(e,t);this.description=n}[Symbol.toStringTag](){return'BlockEnum'}}u.A1=new u('a1','A1','\u0412\u0435\u0440\u0448\u043D\u0438\u0439');u.A2=new u('a2','A2','\u041F\u043E\u0434 \u0432\u0438\u0434\u0435\u043E');u.A3=new u('a3','A3','\u041F\u043E\u0434 \u043D\u043E\u0432\u043E\u0441\u0442\u044C\u044E');u.B1=new u('b1','B1','\u0411\u0430\u0448\u043D\u044F');u.B2=new u('b2','B2','\u0411\u0430\u0448\u043D\u044F');u.B3=new u('b3','B3','\u0411\u0430\u0448\u043D\u044F');u.M1=new u('m1','M1','\u041C\u043E\u0431\u0438\u043B\u044C\u043D\u044B\u0439');u.M2=new u('m2','M2','\u041C\u043E\u0431\u0438\u043B\u044C\u043D\u044B\u0439');u.M3=new u('m3','M3','\u041C\u043E\u0431\u0438\u043B\u044C\u043D\u044B\u0439');const l=/^\{([a-z0-9,]+)\}$/,p=/^\d{4}-\d{2}-\d{3}$/;class c{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;if(e.blocks){const t=l.exec(e.blocks),n=t&&t[1].split(',')||e.blocks;this.blocks=u.getArray(n)}else this.blocks=new Array;this.title=String(e.title||'').trim();this.description=String(e.description||'').trim();this.url=String(e.url||'').trim();this.startDate=new s.a(e.startDate);this.endDate=new s.a(e.endDate);this.content=String(e.content||'').trim();this.files=Array.isArray(e.files)?e.files.map(()=>a(~~e.collected,0)).filter((e)=>0<e):new Array;this.limits='object'===typeof e.limits?{show:a(~~e.limits.show,0),showPerDay:a(~~e.limits.showPerDay,0),showPerUser:a(~~e.limits.showPerUser,0),click:a(~~e.limits.click,0),clickPerDay:a(~~e.limits.clickPerDay,0),clickPerUser:a(~~e.limits.clickPerUser,0)}:{show:0,showPerDay:0,showPerUser:0,click:0,clickPerDay:0,clickPerUser:0};this.stats={};if('object'===e.stats)for(let t in e.stats){t=String(t).trim();if(p.test(t))this.stats[t]={show:a(~~e.stats[t].show,0),click:a(~~e.stats[t].click,0)}}}valueOf(){return{enable:this.enable,blocks:this.blocks.map((e)=>e.valueOf()),title:this.title,description:this.description,url:this.url,startDate:this.startDate,endDate:this.startDate,content:this.content,files:this.files,limits:this.limits}}toJSON(){return{id:this.id,enable:this.enable,blocks:this.blocks,title:this.title,description:this.description,url:this.url,startDate:this.startDate,endDate:this.startDate,content:this.content,files:this.files,limits:this.limits,stats:this.stats}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Ads value to unknown value');}}[Symbol.toStringTag](){return'Ads'}}c.MainFields=['id','enable','blocks','title','startDate','endDate'];class g{constructor(e){this._btc=0;this._usd=0;this.update(e)}get btc(){return this._btc}get usd(){return this._usd}update(e={}){const t=e.btc!==undefined&&a(parseFloat(e.btc),0);this._btc=t||this.btc;const n=e.usd!==undefined&&a(parseFloat(e.usd),0);this._usd=n||this.usd}valueOf(){return{btc:this.btc,usd:this.usd}}toJSON(){return{btc:this.btc,usd:this.usd}}toNumber(){return this.usd||0}toString(){return String(this.toNumber())}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Price value to unknown value');}}[Symbol.toStringTag](){return'Price'}}class m{constructor(e={}){this.price=new g;this.ts=new s.a(e.ts);this.updatePrice(e.price)}updatePrice(e={}){this.price.update(e)}valueOf(){return{ts:this.ts,price:this.price}}toJSON(){return{ts:this.ts,price:this.price}}toNumber(){return this.price.toNumber()}toString(){return String(this.ts)}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Historical value to unknown value');}}[Symbol.toStringTag](){return'Historical'}}const f=/^[A-Z0-9@$]+$/;class y{constructor(e={}){this._max=0;this._available=0;this.price=new g;this._volume24=0;this._historical=new Array;const t=String(e.symbol||'').trim().toUpperCase();if(!f.test(t))throw new TypeError(`Symbol "${t} not match to pattern ${f.source}`);this.symbol=t;this.update(e)}get max(){return this._max}get available(){return this._available}get capitalization(){return{btc:this.price.btc*this.available,usd:this.price.usd*this.available}}get volume24(){return this._volume24}get ts(){return this._ts}get historical(){return this._historical.sort((e,t)=>e.ts<t.ts?-1:1)}get lastHistorical(){const e=this.historical;if(0===e.length)return;return e[e.length-1].ts}updatePrice(e={}){this.price.update(e)}updateHistorical(e=[]){if(!Array.isArray(e))return;e.map((e)=>new m(e)).forEach((e)=>{const t=this._historical.find((t)=>Number(t.ts)===Number(e.ts));if(!t){this._historical.push(e);return}t.updatePrice(e.price)})}update(e={}){if(!e)return;if(e.symbol!==this.symbol)return;this._max=e.max!==undefined?a(parseFloat(e.max),0):0;this._available=e.available!==undefined?a(parseFloat(e.available),0):0;this._volume24=e.volume24!==undefined?a(parseFloat(e.volume24),0):0;this._ts=new s.a(e.ts);this.updatePrice(e.price);this.updateHistorical(e.historical)}valueOf(){return{symbol:this.symbol,max:this.max,available:this.available,price:this.price.valueOf(),capitalization:this.capitalization,volume24:this.volume24,ts:this.ts,historical:this.historical}}toJSON(){return{symbol:this.symbol,max:this.max,available:this.available,price:this.price,capitalization:this.capitalization,volume24:this.volume24,ts:this.ts}}equal(e){return JSON.stringify(e)===JSON.stringify(this)}toNumber(){return this.capitalization.usd}toString(){return this.symbol}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Coin value to unknown value');}}[Symbol.toStringTag](){return'Coin'}}class b{constructor(e={}){this.like=a(~~e.like,0);this.dislike=a(~~e.dislike,0)}get value(){return this.like/(this.like+this.dislike)}get stars(){return 5*this.value}valueOf(){return{like:this.like,dislike:this.dislike}}toJSON(){return{like:this.like,dislike:this.dislike}}toNumber(){return this.value}toString(){return String(this.value)}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Raiting value to unknown value');}}[Symbol.toStringTag](){return'Raiting'}}b.MainFields=['like','dislike'];class h{constructor(e={}){if(!e)e={};this.symbol=String(e.symbol||'').trim();this.enable=e.enable===undefined?true:!!e.enable;this.extUrl=String(e.extUrl||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.startDate=new s.a(e.startDate);this.founder=String(e.founder||'').trim();this.maxCoin=a(~~e.maxCoin,0);this.algorithm=String(e.algorithm||'').trim();this.system=String(e.system||'').trim();this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.branding={}}valueOf(){return{symbol:this.symbol,enable:this.enable,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate,founder:this.founder,maxCoin:this.maxCoin,algorithm:this.algorithm,system:this.system,content:this.content,bjr:this.bjr}}toJSON(){return{symbol:this.symbol,enable:this.enable,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate.isValid?this.startDate:undefined,founder:this.founder,maxCoin:this.maxCoin,algorithm:this.algorithm,system:this.system,content:this.content,rating:this.rating,bjr:this.bjr,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Currency value to unknown value');}}[Symbol.toStringTag](){return'Currency'}}h.MainFields=['symbol','enable','title','image','rating','bjr'];class w{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.url=String(e.url||'').trim();this.extUrl=String(e.extUrl||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.startDate=new s.a(e.startDate);this.referral=!!e.referral;this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.branding={}}valueOf(){return{enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate,referral:this.referral,content:this.content,bjr:this.bjr}}toJSON(){return{id:this.id,enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate.isValid?this.startDate:undefined,referral:this.referral,content:this.content,rating:this.rating,bjr:this.bjr,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Exchange value to unknown value');}}[Symbol.toStringTag](){return'Exchange'}}w.MainFields=['id','enable','url','title','image','rating','bjr'];class v{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.url=String(e.url||'').trim();this.extUrl=String(e.extUrl||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.startDate=new s.a(e.startDate);this.goal=a(~~e.goal,0);this.collected=a(~~e.collected,0);this.status=String(e.status||'').trim();this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.branding={}}valueOf(){return{enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate,goal:this.goal,collected:this.collected,status:this.status,content:this.content,bjr:this.bjr}}toJSON(){return{id:this.id,enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate.isValid?this.startDate:undefined,goal:this.goal,collected:this.collected,status:this.status,content:this.content,rating:this.rating,bjr:this.bjr,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert ICO value to unknown value');}}[Symbol.toStringTag](){return'ICO'}}v.MainFields=['id','enable','url','title','image','rating','bjr'];class _{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.url=String(e.url||'').trim();this.extUrl=String(e.extUrl||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.startDate=new s.a(e.startDate);this.referral=!!e.referral;this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.branding={}}valueOf(){return{enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate,referral:this.referral,content:this.content,bjr:this.bjr}}toJSON(){return{id:this.id,enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate.isValid?this.startDate:undefined,referral:this.referral,content:this.content,rating:this.rating,bjr:this.bjr,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Market value to unknown value');}}[Symbol.toStringTag](){return'Market'}}_.MainFields=['id','enable','url','title','image','rating','bjr'];const E='\u0449  \u0448  \u0447  \u0446  \u044E  \u044F  \u0451 \u0436  \u044B \u044D \u0430 \u0431 \u0432 \u0433 \u0434 \u0435 \u0437 \u0438 \u0439 \u043A \u043B \u043C \u043D \u043E \u043F \u0440 \u0441 \u0442 \u0443 \u0444 \u0445'.split(/\s+/),O='sh sh ch cz yu ya e zh y e a b v g d e z i j k l m n o p r s t u f x'.split(/\s+/);class I{constructor(){}}I.build=(e,t=128)=>{let n=e.toLowerCase().replace(/\s+/g,'_');n=n.split('').map((e)=>{let t=E.indexOf(e);return 0>t?e:O[t]}).join('');n=n.replace(/[^0-9a-z_]/g,'').slice(0,t).replace(/(^_+|_+$)/g,'');return n};class S{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.ts=new s.a(e.ts);this.url=String(e.url||'').trim();this.enable=!!e.enable;this.sections=i.a.getArray(e.sections);this.currencies=Array.isArray(e.currencies)?e.currencies.map((e)=>String(e).trim().toLowerCase()).filter((e)=>!!e):new Array;this.exchanges=i.a.getArray(e.exchanges);this.ico=i.a.getArray(e.ico);this.markets=i.a.getArray(e.markets);this.weight=e.weight===undefined?1:r(a(~~e.weight,0),3);this.bigTitle=String(e.bigTitle||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.authors=i.a.getArray(e.authors);this.tags=Array.isArray(e.tags)?e.tags.map((e)=>String(e).trim().toLowerCase()).filter((e)=>!!e):new Array;this.sharing=e.sharing===undefined?true:!!e.sharing;this.comments=e.comments===undefined?true:!!e.comments;this.ads=e.ads===undefined?true:!!e.ads;this.rss=e.rss===undefined?true:!!e.rss;this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.branding={};this.lastModified=new s.a(e.lastModified);if(!this.url)this.url=I.build(this.title)}valueOf(){return{ts:this.ts,url:this.url,enable:this.enable,sections:this.sections.map((e)=>e.valueOf()),currencies:this.currencies,exchanges:this.exchanges.map((e)=>e.valueOf()),ico:this.ico.map((e)=>e.valueOf()),markets:this.markets.map((e)=>e.valueOf()),weight:this.weight,bigTitle:this.bigTitle,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,authors:this.authors.map((e)=>e.valueOf()),tags:this.tags,sharing:this.sharing,comments:this.comments,ads:this.ads,rss:this.rss,content:this.content}}toJSON(){return{id:this.id,ts:this.ts,url:this.url,enable:this.enable,sections:this.sections,currencies:this.currencies,exchanges:this.exchanges,ico:this.ico,markets:this.markets,weight:this.weight,bigTitle:this.bigTitle,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,authors:this.authors,tags:this.tags,sharing:this.sharing,comments:this.comments,ads:this.ads,rss:this.rss,content:this.content,rating:this.rating,branding:this.branding,lastModified:this.lastModified.isValid?this.lastModified:undefined}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Publication value to unknown value');}}[Symbol.toStringTag](){return'Publication'}}S.MainFields=['id','ts','url','enable','sections','currencies','exchanges','ico','markets','weight','bigTitle','title','description','image','authors','tags','rss','rating','branding','lastModified'];class T{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.url=String(e.url||'').trim()||null;this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.branding={}}valueOf(){return{enable:this.enable,url:this.url,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage}}toJSON(){return{id:this.id,enable:this.enable,url:this.url,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Section value to unknown value');}}[Symbol.toStringTag](){return'Section'}}T.MainFields=['id','enable','url','title'];class A{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.title=String(e.title||'').trim();this.image=a(~~e.image,0)||null}valueOf(){return{enable:this.enable,title:this.title,image:this.image}}toJSON(){return{id:this.id,enable:this.enable,title:this.title,image:this.image}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Status value to unknown value');}}[Symbol.toStringTag](){return'Status'}}A.MainFields=['id','enable','title','image'];class C extends d{constructor(e,t,n){super(e,t);this.icon=n}[Symbol.toStringTag](){return'UserRole'}}C.User=new C('user','\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C',null);C.Author=new C('author','\u0410\u0432\u0442\u043E\u0440',null);C.Publisher=new C('publisher','\u041F\u0443\u0431\u043B\u0438\u043A\u0430\u0442\u043E\u0440',null);C.Chief=new C('chief','\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440',null);C.Administrator=new C('administrator','\u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440',null);C.Su=new C('su','Super user',null);const j=/^\{([a-z0-9,]+)\}$/;class x{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=!!e.enable;if(e.roles){const t=j.exec(e.roles),n=t&&t[1].split(',')||e.roles;this.roles=C.getArray(n)}else this.roles=new Array;this.url=String(e.url||'').trim()||null;this.title=String(e.title||'').trim();this.description=String(e.description||'').trim();this.email=String(e.email||'').trim();this.phone=String(e.phone||'').trim()||null;this.oauth={};this.image=a(~~e.image,0)||null;this.statuses=i.a.getArray(e.statuses);this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.card={}}checkRole(e){for(let t of e)if(this.roles.includes(t))return true;return false}get valid(){return null!==this.id&&null!==this.id.version}valueOf(){return{enable:this.enable,roles:this.roles.map((e)=>e.valueOf()),url:this.url,title:this.title,description:this.description,email:this.email,phone:this.phone,image:this.image,statuses:this.statuses.map((e)=>e.valueOf()),bjr:this.bjr,card:this.card}}toJSON(){return{id:this.id,enable:this.enable,roles:this.roles,url:this.url,title:this.title,description:this.description,email:this.email,phone:this.phone,oauth:this.oauth,image:this.image,statuses:this.statuses,rating:this.rating,bjr:this.bjr,card:this.card}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert User value to unknown value');}}[Symbol.toStringTag](){return'User'}}x.AnonymousFields=['id','title','url','image','statuses','rating','bjr'];x.MainFields=['id','enable','title','email','phone','url','roles','image','statuses','rating','bjr'];class D{constructor(e={}){if(!e)e={};this.id=String(e.id||'').trim();this.enable=e.enable===undefined?true:!!e.enable}valueOf(){return{id:this.id,enable:this.enable}}toJSON(){return{id:this.id,enable:this.enable}}toNumber(){return NaN}toString(){return this.id}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Video value to unknown value');}}[Symbol.toStringTag](){return'Video'}}D.MainFields=['id','enable'];class R{constructor(e={}){if(!e)e={};this.id=new i.a(e.id||null);this.enable=e.enable===undefined?true:!!e.enable;this.url=String(e.url||'').trim();this.extUrl=String(e.extUrl||'').trim();this.title=String(e.title||'').trim();this.ogTitle=String(e.ogTitle||'').trim();this.description=String(e.description||'').trim();this.ogDescription=String(e.ogDescription||'').trim();this.image=a(~~e.image,0)||null;this.ogImage=a(~~e.ogImage,0)||null;this.startDate=new s.a(e.startDate);this.content=String(e.content||'').trim();this.rating=new b(e.rating);this.bjr=r(a(~~e.bjr,0),5);this.branding={}}valueOf(){return{enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate,content:this.content,bjr:this.bjr}}toJSON(){return{id:this.id,enable:this.enable,url:this.url,extUrl:this.extUrl,title:this.title,ogTitle:this.ogTitle,description:this.description,ogDescription:this.ogDescription,image:this.image,ogImage:this.ogImage,startDate:this.startDate.isValid?this.startDate:undefined,content:this.content,rating:this.rating,bjr:this.bjr,branding:this.branding}}toNumber(){return NaN}toString(){return this.title}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Event value to unknown value');}}[Symbol.toStringTag](){return'Event'}}R.MainFields=['id','enable','url','title','image','rating','bjr'];n.d(t,'a',function(){return c});n.d(t,false,function(){return u});n.d(t,'b',function(){return y});n.d(t,'h',function(){return g});n.d(t,'e',function(){return m});n.d(t,'c',function(){return h});n.d(t,'d',function(){return w});n.d(t,'f',function(){return v});n.d(t,'g',function(){return _});n.d(t,'i',function(){return S});n.d(t,false,function(){return b});n.d(t,'k',function(){return T});n.d(t,'l',function(){return A});n.d(t,'j',function(){return C});n.d(t,'m',function(){return x});n.d(t,'n',function(){return D});n.d(t,false,function(){return R})},function(e,t,n){'use strict';var a=n(1),i=n(15);class s extends a.d{constructor(){super();this.pool=i.a}async main(e,t){e.db=await this.pool.connect();await t();e.db.release()}}function r(e=[]){const t=e.map((e)=>e.id);return(n,r,a)=>{if(!a)return a;const i=a.value;a.value=async function(n,r){n.session;if(!n.session){n.debug('=== ACL %s Denied ===\nSession is undefined',t);n.set(403);return await r()}if(!n.session.valid){n.debug('=== ACL %s Denied ===\nSession: %s',t,n.session);n.set(403);return await r()}if(!n.session.user.checkRole(e)){n.debug('=== ACL %s Denied ===\nSession: %s',t,n.session);n.set(403);return await r()}n.debug('=== ACL %s Allow ===\nSession: %s',t,n.session);await i.call(this,n,r)};return a}}var o=n(2);const d=/^[0-9a-z]{128}$/,u=/token\s+([0-9a-f]{128})/;class l{constructor(e){this._ctx=e;this._id='';this._user=null;const t=u.exec(e.request.getHeader('Authorization')||'');this._id=t&&t[1]||''}get id(){return this._id}set id(e){this._id=d.test(e)?e:''}get user(){return this._user}set user(e){if(!e)this._user=null;else{let t=e instanceof o.m?e:new o.m(e);this._user=t.valid?t:null}}get ip(){return this._ctx.request.ip}get valid(){return 0<this.id.length&&this._user instanceof o.m&&this._user.valid}valueOf(){return{id:this._id,user:this._user}}toJSON(){return this.valueOf()}}class p extends a.d{async main(e,t){const n=new l(e),r=e.db,a={text:`SELECT
               "users".*
             FROM
               "sessions"
               LEFT JOIN
               "users"
               ON "sessions"."owner" = "users"."id"
             WHERE
               "sessions"."id" = $1
               AND
               "users"."enable"
               AND
               "sessions"."expires" > timezone('UTC', now())`,values:[n.id]};e.debug(`=== SQL Query SESSION ===\n%s`,a);const i=await r.query(a);e.debug(`=== SQL Result SESSION ===\n%s`,i.rows);if(1===i.rowCount)n.user=new o.m(i.rows[0]);e.session=n;e.debug('=== Input session ===\n%s',e.session);await t();e.debug('=== Output session ===\n%s',e.session)}}n.d(t,'b',function(){return s});n.d(t,'a',function(){return r});n.d(t,false,function(){return l});n.d(t,'c',function(){return p})},function(e,t,n){'use strict';const r=['\u042F\u043D\u0432\u0430\u0440\u044F','\u0424\u0435\u0432\u0440\u0430\u043B\u044F','\u041C\u0430\u0440\u0442\u0430','\u0410\u043F\u0440\u0435\u043B\u044F','\u041C\u0430\u044F','\u0418\u044E\u043D\u044F','\u0418\u044E\u043B\u044F','\u0410\u0432\u0433\u0443\u0441\u0442\u0430','\u0421\u0435\u043D\u0442\u044F\u0431\u0440\u044F','\u041E\u043A\u0442\u044F\u0431\u0440\u044F','\u041D\u043E\u044F\u0431\u0440\u044F','\u0414\u0435\u043A\u0430\u0431\u0440\u044F'];class a extends Date{static fromUnux(e){return new a(1e3*~~e)}constructor(e){super(e)}get isValid(){return!Number.isNaN(this.getTime())}get isInvalid(){return!this.isValid}toURLString(){const e=String(this.getUTCFullYear()),t=String(this.getUTCMonth()+1).padStart(2,'0'),n=String(this.getUTCDate()).padStart(2,'0');return`${e}-${t}-${n}`}compareDateWithOutTime(e){return this.getFullYear()===e.getFullYear()&&this.getMonth()===e.getMonth()&&this.getDate()===e.getDate()}toHRString(){const e=new Date;let t='';if(this.compareDateWithOutTime(e))t+='\u0421\u0435\u0433\u043E\u0434\u043D\u044F';else{e.setDate(e.getDate()-1);if(this.compareDateWithOutTime(e))t+='\u0412\u0447\u0435\u0440\u0430';else{t+=String(this.getDate());t+=' '+r[this.getMonth()];const n=this.getFullYear();if(n!==e.getFullYear())t+=' '+String(n)}}t+=' '+String(this.getHours());t+=':'+String(this.getMinutes()).padStart(2,'0');return t}valueOf(){return new Date(this)}toNumber(){return this.getTime()}toString(){return this.toISOString()}toJSON(){return this.toISOString()}[Symbol.toPrimitive](e){switch(e){case'default':return this.valueOf();case'number':return this.toNumber();case'string':return this.toString();default:throw new TypeError('Cannot convert Model value to unknown value');}}[Symbol.toStringTag](){return'Timestamp'}}n.d(t,'a',function(){return a})},function(e){e.exports=require('util')},function(e){e.exports=require('events')},function(e){e.exports=require('http')},function(e,t,n){'use strict';e.exports={host:'localhost',user:'win32'===process.platform?process.env.USERNAME:process.env.USER,database:'win32'===process.platform?process.env.USERNAME:process.env.USER,password:null,connectionString:undefined,port:5432,rows:0,binary:false,max:10,idleTimeoutMillis:3e4,client_encoding:'',ssl:false,application_name:undefined,fallback_application_name:undefined,parseInputDatesAsUTC:false,statement_timeout:false};var r=n(9),a=r.getTypeParser(20,'text'),i=r.getTypeParser(1016,'text');e.exports.__defineSetter__('parseInt8',function(e){r.setTypeParser(20,'text',e?r.getTypeParser(23,'text'):a);r.setTypeParser(1016,'text',e?r.getTypeParser(1007,'text'):i)})},function(e,t,n){var a=n(31),i=n(36),s=n(18);t.getTypeParser=function(e,t){t=t||'text';if(!o[t]){return r}return o[t][e]||r};t.setTypeParser=function(e,t,n){if('function'==typeof t){n=t;t='text'}o[t][e]=n};t.arrayParser=s;var o={text:{},binary:{}};function r(e){return String(e)}a.init(function(e,t){o.text[e]=t});i.init(function(e,t){o.binary[e]=t})},function(e){e.exports=require('stream')},function(e){e.exports=require('string_decoder')},function(e){e.exports=require('path')},function(e,t,n){'use strict';const u=n(14),l=n(8);function r(e){var t=e.replace(/\\/g,'\\\\').replace(/"/g,'\\"');return'"'+t+'"'}function a(e){for(var t='{',n=0;n<e.length;n++){if(0<n){t=t+','}if(null===e[n]||'undefined'===typeof e[n]){t=t+'NULL'}else if(Array.isArray(e[n])){t=t+a(e[n])}else if(e[n]instanceof Buffer){t+='\\\\x'+e[n].toString('hex')}else{t+=r(p(e[n]))}}t=t+'}';return t}var p=function(e,t){if(e instanceof Buffer){return e}if(ArrayBuffer.isView(e)){var n=Buffer.from(e.buffer,e.byteOffset,e.byteLength);if(n.length===e.byteLength){return n}return n.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(e instanceof Date){if(l.parseInputDatesAsUTC){return d(e)}else{return o(e)}}if(Array.isArray(e)){return a(e)}if(null===e||'undefined'===typeof e){return null}if('object'===typeof e){return i(e,t)}return e.toString()};function i(e,t){if(e&&'function'===typeof e.toPostgres){t=t||[];if(-1!==t.indexOf(e)){throw new Error('circular reference detected while preparing "'+e+'" for query')}t.push(e);return p(e.toPostgres(p),t)}return JSON.stringify(e)}function s(e,t){e=''+e;while(e.length<t){e='0'+e}return e}function o(e){var t=-e.getTimezoneOffset(),n=s(e.getFullYear(),4)+'-'+s(e.getMonth()+1,2)+'-'+s(e.getDate(),2)+'T'+s(e.getHours(),2)+':'+s(e.getMinutes(),2)+':'+s(e.getSeconds(),2)+'.'+s(e.getMilliseconds(),3);if(0>t){n+='-';t*=-1}else{n+='+'}return n+s(Math.floor(t/60),2)+':'+s(t%60,2)}function d(e){var t=s(e.getUTCFullYear(),4)+'-'+s(e.getUTCMonth()+1,2)+'-'+s(e.getUTCDate(),2)+'T'+s(e.getUTCHours(),2)+':'+s(e.getUTCMinutes(),2)+':'+s(e.getUTCSeconds(),2)+'.'+s(e.getUTCMilliseconds(),3);return t+'+00:00'}const c=function(e){return u.createHash('md5').update(e,'utf-8').digest('hex')};e.exports={prepareValue:function(e){return p(e)},normalizeQueryConfig:function(e,t,n){e='string'===typeof e?{text:e}:e;if(t){if('function'===typeof t){e.callback=t}else{e.values=t}}if(n){e.callback=n}return e},postgresMd5PasswordHash:function(e,t,n){var r=c(t+e),a=c(Buffer.concat([Buffer.from(r),n]));return'md5'+a},md5:c}},function(e){e.exports=require('crypto')},function(e,t,n){'use strict';var r=Math.max,a=n(16),i=n.n(a);const s=process.env.POSTGRES_HOST||'localhost',o=r(~~(process.env.POSTGRES_PORT||''),0)||5432,d=process.env.POSTGRES_DB||'postgres',u=process.env.POSTGRES_USER||'postgres',l=process.env.POSTGRES_PASSWORD||'',p=r(~~(process.env.POSTGRES_IDLE_TIMEOUT||'')||0,0)||10,c=r(~~(process.env.POSTGRES_POOL_SIZE||'')||0,0)||10,g=new a.Pool({host:s,port:o,user:u,password:l,database:d,idleTimeoutMillis:1e3*p,max:c});n.d(t,'a',function(){return g})},function(e,t,n){'use strict';var r=n(5),a=n(30),i=n(8),s=n(22),o=n(51);const d=(e)=>{var t=function(t){var n=Object.assign({Client:e},t);return new o(n)};r.inherits(t,o);return t};var u=function(e){this.defaults=i;this.Client=e;this.Query=this.Client.Query;this.Pool=d(this.Client);this._pools=[];this.Connection=s;this.types=n(9)};if('undefined'!==typeof process.env.NODE_PG_FORCE_NATIVE){e.exports=new u(n(24))}else{e.exports=new u(a);e.exports.__defineGetter__('native',function(){delete e.exports.native;var t=null;try{t=new u(n(24))}catch(e){if('MODULE_NOT_FOUND'!==e.code){throw e}console.error(e.message)}e.exports.native=t;return t})}},function(e,t){'use strict';t.parse=function(e,t){return new n(e,t).parse()};function n(e,t){this.source=e;this.transform=t||r;this.position=0;this.entries=[];this.recorded=[];this.dimension=0}n.prototype.isEof=function(){return this.position>=this.source.length};n.prototype.nextCharacter=function(){var e=this.source[this.position++];if('\\'===e){return{value:this.source[this.position++],escaped:true}}return{value:e,escaped:false}};n.prototype.record=function(e){this.recorded.push(e)};n.prototype.newEntry=function(e){var t;if(0<this.recorded.length||e){t=this.recorded.join('');if('NULL'===t&&!e){t=null}if(null!==t)t=this.transform(t);this.entries.push(t);this.recorded=[]}};n.prototype.parse=function(e){var t,r,a;while(!this.isEof()){t=this.nextCharacter();if('{'===t.value&&!a){this.dimension++;if(1<this.dimension){r=new n(this.source.substr(this.position-1),this.transform);this.entries.push(r.parse(true));this.position+=r.position-2}}else if('}'===t.value&&!a){this.dimension--;if(!this.dimension){this.newEntry();if(e)return this.entries}}else if('"'===t.value&&!t.escaped){if(a)this.newEntry(true);a=!a}else if(','===t.value&&!a){this.newEntry()}else{this.record(t.value)}}if(0!==this.dimension){throw new Error('array dimension not balanced')}return this.entries};function r(e){return e}},function(e,t,n){var r=n(17);e.exports={create:function(e,t){return{parse:function(){return r.parse(e,t)}}}}},function(e,t,n){'use strict';var a=n(9);function r(e){this._types=e||a;this.text={};this.binary={}}r.prototype.getOverrides=function(e){switch(e){case'text':return this.text;case'binary':return this.binary;default:return{};}};r.prototype.setTypeParser=function(e,t,n){if('function'===typeof t){n=t;t='text'}this.getOverrides(t)[e]=n};r.prototype.getTypeParser=function(e,t){t=t||'text';return this.getOverrides(t)[e]||this._types.getTypeParser(e,t)};e.exports=r},function(e,t,n){'use strict';var r=n(42),a=n(8),i=n(43).parse,s=function(e,t,n){if(n===undefined){n=process.env['PG'+e.toUpperCase()]}else if(!(false===n)){n=process.env[n]}return t[e]||n||a[e]},o=function(){switch(process.env.PGSSLMODE){case'disable':return false;case'prefer':case'require':case'verify-ca':case'verify-full':return true;}return a.ssl},d=function(e){e='string'===typeof e?i(e):e||{};if(e.connectionString){e=Object.assign({},e,i(e.connectionString))}this.user=s('user',e);this.database=s('database',e);this.port=parseInt(s('port',e),10);this.host=s('host',e);this.password=s('password',e);this.binary=s('binary',e);this.ssl='undefined'===typeof e.ssl?o():e.ssl;this.client_encoding=s('client_encoding',e);this.replication=s('replication',e);this.isDomainSocket=!(this.host||'').indexOf('/');this.application_name=s('application_name',e,'PGAPPNAME');this.fallback_application_name=s('fallback_application_name',e,false);this.statement_timeout=s('statement_timeout',e,false)},u=function(e){return'\''+(''+e).replace(/\\/g,'\\\\').replace(/'/g,'\\\'')+'\''},l=function(e,t,n){var r=t[n];if(r){e.push(n+'='+u(r))}};d.prototype.getLibpqConnectionString=function(e){var t=[];l(t,this,'user');l(t,this,'password');l(t,this,'port');l(t,this,'application_name');l(t,this,'fallback_application_name');var n='object'===typeof this.ssl?this.ssl:{sslmode:this.ssl};l(t,n,'sslmode');l(t,n,'sslca');l(t,n,'sslkey');l(t,n,'sslcert');l(t,n,'sslrootcert');if(this.database){t.push('dbname='+u(this.database))}if(this.replication){t.push('replication='+u(this.replication))}if(this.host){t.push('host='+u(this.host))}if(this.isDomainSocket){return e(null,t.join(' '))}if(this.client_encoding){t.push('client_encoding='+u(this.client_encoding))}r.lookup(this.host,function(n,r){if(n)return e(n,null);t.push('hostaddr='+u(r));return e(null,t.join(' '))})};e.exports=d},function(e){e.exports=require('url')},function(e,t,n){'use strict';var r=n(47),a=n(6).EventEmitter,i=n(5),s=n(48),o=n(49),d=0,u=function(e){a.call(this);e=e||{};this.stream=e.stream||new r.Stream;this._keepAlive=e.keepAlive;this.lastBuffer=false;this.lastOffset=0;this.buffer=null;this.offset=null;this.encoding=e.encoding||'utf8';this.parsedStatements={};this.writer=new s;this.ssl=e.ssl||false;this._ending=false;this._mode=d;this._emitMessage=false;this._reader=new o({headerSize:1,lengthPadding:-4});var t=this;this.on('newListener',function(e){if('message'===e){t._emitMessage=true}})};i.inherits(u,a);u.prototype.connect=function(e,t){if('closed'===this.stream.readyState){this.stream.connect(e,t)}else if('open'===this.stream.readyState){this.emit('connect')}var r=this;this.stream.on('connect',function(){if(r._keepAlive){r.stream.setKeepAlive(true)}r.emit('connect')});this.stream.on('error',function(e){if(r._ending&&'ECONNRESET'===e.code){return}r.emit('error',e)});this.stream.on('close',function(){r.emit('end')});if(!this.ssl){return this.attachListeners(this.stream)}this.stream.once('data',function(e){var a=e.toString('utf8');if('S'!==a){return r.emit('error',new Error('The server does not support SSL connections'))}var i=n(50);r.stream=i.connect({socket:r.stream,servername:t,rejectUnauthorized:r.ssl.rejectUnauthorized,ca:r.ssl.ca,pfx:r.ssl.pfx,key:r.ssl.key,passphrase:r.ssl.passphrase,cert:r.ssl.cert,NPNProtocols:r.ssl.NPNProtocols});r.attachListeners(r.stream);r.emit('sslconnect');r.stream.on('error',function(e){r.emit('error',e)})})};u.prototype.attachListeners=function(e){var t=this;e.on('data',function(e){t._reader.addChunk(e);var n=t._reader.read();while(n){var r=t.parseMessage(n);if(t._emitMessage){t.emit('message',r)}t.emit(r.name,r);n=t._reader.read()}});e.on('end',function(){t.emit('end')})};u.prototype.requestSsl=function(){var e=this.writer.addInt16(1234).addInt16(5679).flush(),t=e.length+4,n=new s().addInt32(t).add(e).join();this.stream.write(n)};u.prototype.startup=function(e){var t=this.writer.addInt16(3).addInt16(0);Object.keys(e).forEach(function(n){var r=e[n];t.addCString(n).addCString(r)});t.addCString('client_encoding').addCString('\'utf-8\'');var n=t.addCString('').flush(),r=n.length+4,a=new s().addInt32(r).add(n).join();this.stream.write(a)};u.prototype.cancel=function(e,t){var n=this.writer.addInt16(1234).addInt16(5678).addInt32(e).addInt32(t).flush(),r=n.length+4,a=new s().addInt32(r).add(n).join();this.stream.write(a)};u.prototype.password=function(e){this._send(112,this.writer.addCString(e))};u.prototype._send=function(e,t){if(!this.stream.writable){return false}if(true===t){this.writer.addHeader(e)}else{return this.stream.write(this.writer.flush(e))}};u.prototype.query=function(e){this.stream.write(this.writer.addCString(e).flush(81))};u.prototype.parse=function(e,t){e.name=e.name||'';if(63<e.name.length){console.error('Warning! Postgres only supports 63 characters for query names.');console.error('You supplied',e.name,'(',e.name.length,')');console.error('This can cause conflicts and silent errors executing queries')}e.types=e.types||[];for(var n=e.types.length,r=this.writer.addCString(e.name).addCString(e.text).addInt16(n),a=0;a<n;a++){r.addInt32(e.types[a])}this._send(80,t)};u.prototype.bind=function(e,t){e=e||{};e.portal=e.portal||'';e.statement=e.statement||'';e.binary=e.binary||false;for(var n=e.values||[],r=n.length,a=false,s=0;s<r;s++){a|=n[s]instanceof Buffer}var o=this.writer.addCString(e.portal).addCString(e.statement);if(!a){o.addInt16(0)}else{o.addInt16(r);for(s=0;s<r;s++){o.addInt16(n[s]instanceof Buffer)}}o.addInt16(r);for(var d=0,i;d<r;d++){i=n[d];if(null===i||'undefined'===typeof i){o.addInt32(-1)}else if(i instanceof Buffer){o.addInt32(i.length);o.add(i)}else{o.addInt32(Buffer.byteLength(i));o.addString(i)}}if(e.binary){o.addInt16(1);o.addInt16(1)}else{o.addInt16(0)}this._send(66,t)};u.prototype.execute=function(e,t){e=e||{};e.portal=e.portal||'';e.rows=e.rows||'';this.writer.addCString(e.portal).addInt32(e.rows);this._send(69,t)};var l=Buffer.alloc(0);u.prototype.flush=function(){this.writer.add(l);this._send(72)};u.prototype.sync=function(){this.writer.flush(0);this.writer.add(l);this._ending=true;this._send(83)};const p=Buffer.from([88,0,0,0,4]);u.prototype.end=function(){this.writer.add(l);this._ending=true;return this.stream.write(p)};u.prototype.close=function(e,t){this.writer.addCString(e.type+(e.name||''));this._send(67,t)};u.prototype.describe=function(e,t){this.writer.addCString(e.type+(e.name||''));this._send(68,t)};u.prototype.sendCopyFromChunk=function(e){this.stream.write(this.writer.add(e).flush(100))};u.prototype.endCopyFrom=function(){this.stream.write(this.writer.add(l).flush(99))};u.prototype.sendCopyFail=function(e){this.writer.addCString(e);this._send(102)};var c=function(e,t){this.name=e;this.length=t};u.prototype.parseMessage=function(e){this.offset=0;var t=e.length+4;switch(this._reader.header){case 82:return this.parseR(e,t);case 83:return this.parseS(e,t);case 75:return this.parseK(e,t);case 67:return this.parseC(e,t);case 90:return this.parseZ(e,t);case 84:return this.parseT(e,t);case 68:return this.parseD(e,t);case 69:return this.parseE(e,t);case 78:return this.parseN(e,t);case 49:return new c('parseComplete',t);case 50:return new c('bindComplete',t);case 51:return new c('closeComplete',t);case 65:return this.parseA(e,t);case 110:return new c('noData',t);case 73:return new c('emptyQuery',t);case 115:return new c('portalSuspended',t);case 71:return this.parseG(e,t);case 72:return this.parseH(e,t);case 87:return new c('replicationStart',t);case 99:return new c('copyDone',t);case 100:return this.parsed(e,t);}};u.prototype.parseR=function(e,t){var n=0,r=new c('authenticationOk',t);if(8===r.length){n=this.parseInt32(e);if(3===n){r.name='authenticationCleartextPassword'}return r}if(12===r.length){n=this.parseInt32(e);if(5===n){r.name='authenticationMD5Password';r.salt=Buffer.alloc(4);e.copy(r.salt,0,this.offset,this.offset+4);this.offset+=4;return r}}throw new Error('Unknown authenticationOk message type'+i.inspect(r))};u.prototype.parseS=function(e,t){var n=new c('parameterStatus',t);n.parameterName=this.parseCString(e);n.parameterValue=this.parseCString(e);return n};u.prototype.parseK=function(e,t){var n=new c('backendKeyData',t);n.processID=this.parseInt32(e);n.secretKey=this.parseInt32(e);return n};u.prototype.parseC=function(e,t){var n=new c('commandComplete',t);n.text=this.parseCString(e);return n};u.prototype.parseZ=function(e,t){var n=new c('readyForQuery',t);n.name='readyForQuery';n.status=this.readString(e,1);return n};u.prototype.parseT=function(e,t){var n=new c('rowDescription',t);n.fieldCount=this.parseInt16(e);for(var r=[],a=0;a<n.fieldCount;a++){r.push(this.parseField(e))}n.fields=r;return n};var g=function(){this.name=null;this.tableID=null;this.columnID=null;this.dataTypeID=null;this.dataTypeSize=null;this.dataTypeModifier=null;this.format=null};u.prototype.parseField=function(e){var t=new g;t.name=this.parseCString(e);t.tableID=this.parseInt32(e);t.columnID=this.parseInt16(e);t.dataTypeID=this.parseInt32(e);t.dataTypeSize=this.parseInt16(e);t.dataTypeModifier=this.parseInt32(e);if(this.parseInt16(e)===d){this._mode=d;t.format='text'}else{this._mode=1;t.format='binary'}return t};var m=function(e,t){this.name='dataRow';this.length=e;this.fieldCount=t;this.fields=[]};u.prototype.parseD=function(e,t){for(var n=this.parseInt16(e),r=new m(t,n),a=0;a<n;a++){r.fields.push(this._readValue(e))}return r};u.prototype._readValue=function(e){var t=this.parseInt32(e);if(-1===t)return null;if(this._mode===d){return this.readString(e,t)}return this.readBytes(e,t)};u.prototype.parseE=function(e,t){var n={},r,a,i=new c('error',t),s=this.readString(e,1);while('\0'!==s){n[s]=this.parseCString(e);s=this.readString(e,1)}if('error'===i.name){r=new Error(n.M);for(a in i){if(i.hasOwnProperty(a)){r[a]=i[a]}}}else{r=i;r.message=n.M}r.severity=n.S;r.code=n.C;r.detail=n.D;r.hint=n.H;r.position=n.P;r.internalPosition=n.p;r.internalQuery=n.q;r.where=n.W;r.schema=n.s;r.table=n.t;r.column=n.c;r.dataType=n.d;r.constraint=n.n;r.file=n.F;r.line=n.L;r.routine=n.R;return r};u.prototype.parseN=function(e,t){var n=this.parseE(e,t);n.name='notice';return n};u.prototype.parseA=function(e,t){var n=new c('notification',t);n.processId=this.parseInt32(e);n.channel=this.parseCString(e);n.payload=this.parseCString(e);return n};u.prototype.parseG=function(e,t){var n=new c('copyInResponse',t);return this.parseGH(e,n)};u.prototype.parseH=function(e,t){var n=new c('copyOutResponse',t);return this.parseGH(e,n)};u.prototype.parseGH=function(e,t){var n=0!==e[this.offset];this.offset++;t.binary=n;var r=this.parseInt16(e);t.columnTypes=[];for(var a=0;a<r;a++){t.columnTypes.push(this.parseInt16(e))}return t};u.prototype.parsed=function(e,t){var n=new c('copyData',t);n.chunk=this.readBytes(e,n.length-4);return n};u.prototype.parseInt32=function(e){var t=e.readInt32BE(this.offset,true);this.offset+=4;return t};u.prototype.parseInt16=function(e){var t=e.readInt16BE(this.offset,true);this.offset+=2;return t};u.prototype.readString=function(e,t){return e.toString(this.encoding,this.offset,this.offset+=t)};u.prototype.readBytes=function(e,t){return e.slice(this.offset,this.offset+=t)};u.prototype.parseCString=function(e){var t=this.offset,n=e.indexOf(0,t);this.offset=n+1;return e.toString(this.encoding,t,n)};e.exports=u},function(e){e.exports=require('assert')},function(e,t,n){'use strict';e.exports=n(52)},function(e){'use strict';e.exports=function(e,t,n){const r=n&&n.twoArgs;return new Promise(function(n,a){e.call(t,function(e,t,i){if(e){a(e);return}if(r){n([t,i])}else{n(t)}})})}},function(e,t,n){'use strict';var a=n(25),i=n(27),s=n(28);function r(e,t,n){this._query=e;this.oid=t;this._fd=n}r.SEEK_SET=0;r.SEEK_CUR=1;r.SEEK_END=2;r.prototype.close=function(e){this._query({name:'npg_lo_close',text:'SELECT lo_close($1) as ok',values:[this._fd]},e?function(t){e(t)}:undefined)};r.prototype.closeAsync=function(){return a(function(e){this.close(e)},this)};r.prototype.read=function(e,t){this._query({name:'npg_loread',text:'SELECT loread($1, $2) as data',values:[this._fd,e]},function(e,n){if(e)return t(e);var r=n.rows[0].data;t(null,r)})};r.prototype.readAsync=function(e){return a(function(t){this.read(e,t)},this)};r.prototype.write=function(e,t){this._query({name:'npg_lowrite',text:'SELECT lowrite($1, $2)',values:[this._fd,e]},t?function(e){t(e)}:undefined)};r.prototype.writeAsync=function(e){return a(function(t){this.write(e,t)},this)};r.prototype.seek=function(e,t,n){this._query({name:'npg_lo_lseek64',text:'SELECT lo_lseek64($1, $2, $3) as location',values:[this._fd,e,t]},n?function(e,t){if(e)return n(e);var r=t.rows[0].location;n(null,r)}:undefined)};r.prototype.seekAsync=function(e,t){return a(function(n){this.seek(e,t,n)},this)};r.prototype.tell=function(e){this._query({name:'npg_lo_tell64',text:'SELECT lo_tell64($1) as location',values:[this._fd]},function(t,n){if(t)return e(t);var r=n.rows[0].location;e(null,r)})};r.prototype.tellAsync=function(){return a(function(e){this.tell(e)},this)};r.prototype.size=function(e){this._query({name:'npg_size',text:'SELECT lo_lseek64($1, location, 0), seek.size FROM (SELECT lo_lseek64($1, 0, 2) AS SIZE, tell.location FROM (SELECT lo_tell64($1) AS location) tell) seek;',values:[this._fd]},function(t,n){if(t)return e(t);var r=n.rows[0].size;e(null,r)})};r.prototype.sizeAsync=function(){return a(function(e){this.size(e)},this)};r.prototype.truncate=function(e,t){this._query({name:'npg_lo_truncate64',text:'SELECT lo_truncate64($1, $2)',values:[this._fd,e]},t?function(e){t(e)}:undefined)};r.prototype.truncateAsync=function(e){return a(function(t){this.truncate(e,t)},this)};r.prototype.getReadableStream=function(e){return new i(this,e)};r.prototype.getWritableStream=function(e){return new s(this,e)};e.exports=r},function(e,t,n){'use strict';var a=n(10);function r(e,t){a.Readable.call(this,{highWaterMark:t||16384,encoding:null,objectMode:false});this._largeObject=e}r.prototype=Object.create(a.Readable.prototype);r.prototype._read=function(e){if(0>=e){throw'Illegal Argument'}this._largeObject.read(e,function(t,n){if(t){this.emit('error',t);return}this.push(n);if(n.length<e){this.push(null)}}.bind(this))};e.exports=r},function(e,t,n){'use strict';var a=n(10);function r(e,t){a.Writable.call(this,{highWaterMark:t||16384,decodeStrings:true,objectMode:false});this._largeObject=e}r.prototype=Object.create(a.Writable.prototype);r.prototype._write=function(e,t,n){if(!Buffer.isBuffer(e)){throw'Illegal Argument'}this._largeObject.write(e,n)};e.exports=r},function(e){e.exports=require('querystring')},function(e,t,n){'use strict';var r=n(6).EventEmitter,a=n(5),i=n(13),s=n(37),o=n(19),d=n(20),u=n(44),l=n(8),p=n(22),c=function(e){r.call(this);this.connectionParameters=new d(e);this.user=this.connectionParameters.user;this.database=this.connectionParameters.database;this.port=this.connectionParameters.port;this.host=this.connectionParameters.host;this.password=this.connectionParameters.password;this.replication=this.connectionParameters.replication;var t=e||{};this._types=new o(t.types);this._ending=false;this._connecting=false;this._connected=false;this._connectionError=false;this.connection=t.connection||new p({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||false,encoding:this.connectionParameters.client_encoding||'utf8'});this.queryQueue=[];this.binary=t.binary||l.binary;this.processID=null;this.secretKey=null;this.ssl=this.connectionParameters.ssl||false};a.inherits(c,r);c.prototype.connect=function(e){var n=this,r=this.connection;if(this._connecting||this._connected){const t=new Error('Client has already been connected. You cannot reuse a client.');if(e){e(t);return}return Promise.reject(t)}this._connecting=true;if(this.host&&0===this.host.indexOf('/')){r.connect(this.host+'/.s.PGSQL.'+this.port)}else{r.connect(this.port,this.host)}r.on('connect',function(){if(n.ssl){r.requestSsl()}else{r.startup(n.getStartupConf())}});r.on('sslconnect',function(){r.startup(n.getStartupConf())});function t(e){return function(t){if(null!==n.password){e(t)}else{s(n.connectionParameters,function(r){if(undefined!==r){n.connectionParameters.password=n.password=r}e(t)})}}}r.on('authenticationCleartextPassword',t(function(){r.password(n.password)}));r.on('authenticationMD5Password',t(function(e){r.password(i.postgresMd5PasswordHash(n.user,n.password,e.salt))}));r.once('backendKeyData',function(e){n.processID=e.processID;n.secretKey=e.secretKey});const a=(t)=>{if(this._connectionError){return}this._connectionError=true;if(e){return e(t)}this.emit('error',t)},o=(e)=>{if(this.activeQuery){var t=n.activeQuery;this.activeQuery=null;return t.handleError(e,r)}this.emit('error',e)};r.on('error',a);r.once('readyForQuery',function(){n._connecting=false;n._connected=true;n._attachListeners(r);r.removeListener('error',a);r.on('error',o);if(e){e(null,n);e=null}n.emit('connect')});r.on('readyForQuery',function(){var e=n.activeQuery;n.activeQuery=null;n.readyForQuery=true;if(e){e.handleReadyForQuery(r)}n._pulseQueryQueue()});r.once('end',()=>{if(this.activeQuery){var t=new Error('Connection terminated');this.activeQuery.handleError(t,r);this.activeQuery=null}if(!this._ending){const t=new Error('Connection terminated unexpectedly');if(this._connecting&&!this._connectionError){if(e){e(t)}else{this.emit('error',t)}}else if(!this._connectionError){this.emit('error',t)}}this.emit('end')});r.on('notice',function(e){n.emit('notice',e)});if(!e){return new global.Promise((e,t)=>{this.once('error',t);this.once('connect',()=>{this.removeListener('error',t);e()})})}};c.prototype._attachListeners=function(e){const t=this;e.on('rowDescription',function(e){t.activeQuery.handleRowDescription(e)});e.on('dataRow',function(e){t.activeQuery.handleDataRow(e)});e.on('portalSuspended',function(){t.activeQuery.handlePortalSuspended(e)});e.on('emptyQuery',function(){t.activeQuery.handleEmptyQuery(e)});e.on('commandComplete',function(n){t.activeQuery.handleCommandComplete(n,e)});e.on('parseComplete',function(){if(t.activeQuery.name){e.parsedStatements[t.activeQuery.name]=true}});e.on('copyInResponse',function(){t.activeQuery.handleCopyInResponse(t.connection)});e.on('copyData',function(e){t.activeQuery.handleCopyData(e,t.connection)});e.on('notification',function(e){t.emit('notification',e)})};c.prototype.getStartupConf=function(){var e=this.connectionParameters,t={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;if(n){t.application_name=n}if(e.replication){t.replication=''+e.replication}if(e.statement_timeout){t.statement_timeout=String(parseInt(e.statement_timeout,10))}return t};c.prototype.cancel=function(e,t){if(e.activeQuery===t){var n=this.connection;if(this.host&&0===this.host.indexOf('/')){n.connect(this.host+'/.s.PGSQL.'+this.port)}else{n.connect(this.port,this.host)}n.on('connect',function(){n.cancel(e.processID,e.secretKey)})}else if(-1!==e.queryQueue.indexOf(t)){e.queryQueue.splice(e.queryQueue.indexOf(t),1)}};c.prototype.setTypeParser=function(e,t,n){return this._types.setTypeParser(e,t,n)};c.prototype.getTypeParser=function(e,t){return this._types.getTypeParser(e,t)};c.prototype.escapeIdentifier=function(e){for(var t='"',n=0,r;n<e.length;n++){r=e[n];if('"'===r){t+=r+r}else{t+=r}}t+='"';return t};c.prototype.escapeLiteral=function(e){for(var t=false,n='\'',r=0,a;r<e.length;r++){a=e[r];if('\''===a){n+=a+a}else if('\\'===a){n+=a+a;t=true}else{n+=a}}n+='\'';if(true===t){n=' E'+n}return n};c.prototype._pulseQueryQueue=function(){if(true===this.readyForQuery){this.activeQuery=this.queryQueue.shift();if(this.activeQuery){this.readyForQuery=false;this.hasExecuted=true;this.activeQuery.submit(this.connection)}else if(this.hasExecuted){this.activeQuery=null;this.emit('drain')}}};c.prototype.query=function(e,t,n){var r,a;if('function'===typeof e.submit){a=r=e;if('function'===typeof t){r.callback=r.callback||t}}else{r=new u(e,t,n);if(!r.callback){let e,t;a=new Promise((n,r)=>{e=n;t=r});r.callback=(n,r)=>n?t(n):e(r)}}if(this.binary&&!r.binary){r.binary=true}if(r._result){r._result._getTypeParser=this._types.getTypeParser.bind(this._types)}this.queryQueue.push(r);this._pulseQueryQueue();return a};c.prototype.end=function(e){this._ending=true;if(this.activeQuery){this.connection.stream.destroy(new Error('Connection terminated by user'));return e?e():Promise.resolve()}if(e){this.connection.end();this.connection.once('end',e)}else{return new global.Promise((e)=>{this.connection.end();this.connection.once('end',e)})}};c.Query=u;e.exports=c},function(e,t,n){var u=n(17),l=n(18),p=n(32),c=n(33),g=n(35);function r(e){return function(t){if(null===t)return t;return e(t)}}function a(e){if(null===e)return e;return'TRUE'===e||'t'===e||'true'===e||'y'===e||'yes'===e||'on'===e||'1'===e}function i(e){if(!e)return null;return u.parse(e,a)}function s(e){return parseInt(e,10)}function o(e){if(!e)return null;return u.parse(e,r(s))}function d(e){if(!e)return null;return u.parse(e,r(function(e){return v(e).trim()}))}var m=function(e){if(!e){return null}var t=l.create(e,function(e){if(null!==e){e=E(e)}return e});return t.parse()},f=function(e){if(!e){return null}var t=l.create(e,function(e){if(null!==e){e=parseFloat(e)}return e});return t.parse()},y=function(e){if(!e){return null}var t=l.create(e);return t.parse()},b=function(e){if(!e){return null}var t=l.create(e,function(e){if(null!==e){e=p(e)}return e});return t.parse()},h=function(e){if(!e){return null}return u.parse(e,r(g))},w=function(e){return parseInt(e,10)},v=function(e){var t=String(e);if(/^\d+$/.test(t)){return t}return e},_=function(e){var t=y(e);if(!t){return t}return t.map(function(e){return JSON.parse(e)})},E=function(e){if('('!==e[0]){return null}e=e.substring(1,e.length-1).split(',');return{x:parseFloat(e[0]),y:parseFloat(e[1])}},O=function(e){if('<'!==e[0]&&'('!==e[1]){return null}for(var t='(',n='',r=false,a=2;a<e.length-1;a++){if(!r){t+=e[a]}if(')'===e[a]){r=true;continue}else if(!r){continue}if(','===e[a]){continue}n+=e[a]}var i=E(t);i.radius=parseFloat(n);return i};e.exports={init:function(e){e(20,v);e(21,w);e(23,w);e(26,w);e(700,parseFloat);e(701,parseFloat);e(16,a);e(1082,p);e(1114,p);e(1184,p);e(600,E);e(651,y);e(718,O);e(1e3,i);e(1001,h);e(1005,o);e(1007,o);e(1028,o);e(1016,d);e(1017,m);e(1021,f);e(1022,f);e(1231,f);e(1014,y);e(1015,y);e(1008,y);e(1009,y);e(1040,y);e(1041,y);e(1115,b);e(1182,b);e(1185,b);e(1186,c);e(17,g);e(114,JSON.parse.bind(JSON));e(3802,JSON.parse.bind(JSON));e(199,_);e(3807,_);e(3907,y);e(2951,y);e(791,y);e(1183,y);e(1270,y)}}},function(e){'use strict';var r=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?/,a=/^(\d{1,})-(\d{2})-(\d{2})$/,i=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,s=/BC$/,o=/^-?infinity$/;e.exports=function(e){if(o.test(e)){return Number(e.replace('i','I'))}var i=r.exec(e);if(!i){return a.test(e)?t(e):null}var d=s.test(e),u=parseInt(i[1],10),l=0<u&&100>u;u=(d?'-':'')+u;var p=parseInt(i[2],10)-1,c=i[3],g=parseInt(i[4],10),m=parseInt(i[5],10),f=parseInt(i[6],10),y=i[7];y=y?1e3*parseFloat(y):0;var b,h=n(e);if(null!=h){var w=Date.UTC(u,p,c,g,m,f,y);b=new Date(w-h)}else{b=new Date(u,p,c,g,m,f,y)}if(l){b.setUTCFullYear(u)}return b};function t(e){var t=a.exec(e),n=parseInt(t[1],10),r=parseInt(t[2],10)-1,i=t[3],s=new Date(n,r,i);s.setFullYear(n);return s}function n(e){var t=i.exec(e.split(' ')[1]);if(!t)return;var n=t[1];if('Z'===n){return 0}var r='-'===n?-1:1,a=3600*parseInt(t[2],10)+60*parseInt(t[3]||0,10)+parseInt(t[4]||0,10);return 1e3*(a*r)}},function(e,t,n){'use strict';var s=n(34);e.exports=r;function r(e){if(!(this instanceof r)){return new r(e)}s(this,i(e))}var o=['seconds','minutes','hours','days','months','years'];r.prototype.toPostgres=function(){var e=o.filter(this.hasOwnProperty,this);if(this.milliseconds&&0>e.indexOf('seconds')){e.push('seconds')}if(0===e.length)return'0';return e.map(function(e){var t=this[e]||0;if('seconds'===e&&this.milliseconds){t=(t+this.milliseconds/1e3).toFixed(6).replace(/0+$/,'')}return t+' '+e},this).join(' ')};var d={years:'Y',months:'M',days:'D',hours:'H',minutes:'M',seconds:'S'},u=['years','months','days'],l=['hours','minutes','seconds'];r.prototype.toISO=function(){var t=u.map(e,this).join(''),n=l.map(e,this).join('');return'P'+t+'T'+n;function e(e){var t=this[e]||0;if('seconds'===e&&this.milliseconds){t=(t+this.milliseconds/1e3).toFixed(6).replace(/0+$/,'')}return t+d[e]}};var p='([+-]?\\d+)',c=new RegExp([p+'\\s+years?',p+'\\s+mons?',p+'\\s+days?','([+-])?([\\d]*):(\\d\\d):(\\d\\d).?(\\d{1,6})?'].map(function(e){return'('+e+')?'}).join('\\s*')),g={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},m=['hours','minutes','seconds','milliseconds'];function a(e){var t=e+'000000'.slice(e.length);return parseInt(t,10)/1e3}function i(e){if(!e)return{};var t=c.exec(e),n='-'===t[8];return Object.keys(g).reduce(function(e,r){var i=g[r],s=t[i];if(!s)return e;s='milliseconds'===r?a(s):parseInt(s,10);if(!s)return e;if(n&&~m.indexOf(r)){s*=-1}e[r]=s;return e},{})}},function(e){e.exports=function(e){for(var n=1,r;n<arguments.length;n++){r=arguments[n];for(var a in r){if(t.call(r,a)){e[a]=r[a]}}}return e};var t=Object.prototype.hasOwnProperty},function(e){'use strict';var t=Math.floor;e.exports=function(e){if(/^\\x/.test(e)){return new Buffer(e.substr(2),'hex')}var n='',r=0;while(r<e.length){if('\\'!==e[r]){n+=e[r];++r}else{if(/[0-7]{3}/.test(e.substr(r+1,3))){n+=String.fromCharCode(parseInt(e.substr(r+1,3),8));r+=4}else{var a=1;while(r+a<e.length&&'\\'===e[r+a]){a++}for(var i=0;i<t(a/2);++i){n+='\\'}r+=2*t(a/2)}}}return new Buffer(n,'binary')}},function(e){var t=Math.pow,n=function(e,n,r,a,s){r=r||0;a=a||false;s=s||function(e,n,r){return e*t(2,r)+n};var o=r>>3,d=function(e){if(a){return 255&~e}return e},u=255,l=8-r%8;if(n<l){u=255&255<<8-n;l=n}if(r){u=u>>r%8}var p=0;if(8<=r%8+n){p=s(0,d(e[o])&u,l)}for(var c=n+r>>3,g=o+1;g<c;g++){p=s(p,d(e[g]),8)}var i=(n+r)%8;if(0<i){p=s(p,d(e[c])>>8-i,i)}return p},r=function(e,r,a){var i=t(2,a-1)-1,s=n(e,1),o=n(e,a,1);if(0===o){return 0}var d=1,u=n(e,r,a+1,false,function(e,t,n){if(0===e){e=1}for(var r=1;r<=n;r++){d/=2;if(0<(t&1<<n-r)){e+=d}}return e});if(o==t(2,a+1)-1){if(0===u){return 0===s?Infinity:-Infinity}return NaN}return(0===s?1:-1)*t(2,o-i)*u},a=function(e){if(1==n(e,1)){return-1*(n(e,15,1,true)+1)}return n(e,15,1)},i=function(e){if(1==n(e,1)){return-1*(n(e,31,1,true)+1)}return n(e,31,1)},s=function(e){return r(e,23,8)},o=function(e){return r(e,52,11)},d=function(e){var r=n(e,16,32);if(49152==r){return NaN}for(var a=t(1e4,n(e,16,16)),s=0,o=n(e,16),d=0;d<o;d++){s+=n(e,16,64+16*d)*a;a/=1e4}var i=t(10,n(e,16,48));return(0===r?1:-1)*Math.round(s*i)/i},u=function(e,t){var r=n(t,1),a=n(t,63,1),i=new Date((0===r?1:-1)*a/1e3+9.466848e11);if(!e){i.setTime(i.getTime()+6e4*i.getTimezoneOffset())}i.usec=a%1e3;i.getMicroSeconds=function(){return this.usec};i.setMicroSeconds=function(e){this.usec=e};i.getUTCMicroSeconds=function(){return this.usec};return i},l=function(e){for(var t=n(e,32),r=n(e,32,32),a=n(e,32,64),s=96,o=[],d=0;d<t;d++){o[d]=n(e,32,s);s+=32;s+=32}var u=function(t){var r=n(e,32,s);s+=32;if(4294967295==r){return null}var a;if(23==t||20==t){a=n(e,8*r,s);s+=8*r;return a}else if(25==t){a=e.toString(this.encoding,s>>3,(s+=r<<3)>>3);return a}else{console.log('ERROR: ElementType not implemented: '+t)}},l=function(e,t){var n=[],r;if(1<e.length){var a=e.shift();for(r=0;r<a;r++){n[r]=l(e,t)}e.unshift(a)}else{for(r=0;r<e[0];r++){n[r]=u(t)}}return n};return l(o,a)},p=function(e){return e.toString('utf8')},c=function(e){if(null===e)return null;return 0<n(e,8)};e.exports={init:function(e){e(21,a);e(23,i);e(26,i);e(1700,d);e(700,s);e(701,o);e(16,c);e(1114,u.bind(null,false));e(1184,u.bind(null,true));e(1e3,l);e(1007,l);e(1016,l);e(1008,l);e(1009,l);e(25,p)}}},function(e,t,n){'use strict';var r=n(12),a=n(38),i=n(39);e.exports=function(e,t){var n=i.getFileName();a.stat(n,function(r,s){if(r||!i.usePgPass(s,n)){return t(undefined)}var o=a.createReadStream(n);i.getPassword(e,o,t)})};e.exports.warnTo=i.warnTo},function(e){e.exports=require('fs')},function(e,t,n){'use strict';var i=n(12),s=n(10).Stream,o=n(40),d=n(5),u='win32'===process.platform,l=process.stderr;function r(e){return(e&61440)==32768}var p=['host','port','database','user','password'],c=p.length,g=p[c-1];function a(){var e=l instanceof s&&true===l.writable;if(e){var t=Array.prototype.slice.call(arguments).concat('\n');l.write(d.format.apply(d,t))}}Object.defineProperty(e.exports,'isWin',{get:function(){return u},set:function(e){u=e}});e.exports.warnTo=function(e){var t=l;l=e;return t};e.exports.getFileName=function(e){e=e||process.env;var t=e.PGPASSFILE||(u?i.join(e.APPDATA,'postgresql','pgpass.conf'):i.join(e.HOME,'.pgpass'));return t};e.exports.usePgPass=function(e,t){if(Object.prototype.hasOwnProperty.call(process.env,'PGPASSWORD')){return false}if(u){return true}t=t||'<unkn>';if(!r(e.mode)){a('WARNING: password file "%s" is not a plain file',t);return false}if(e.mode&(56|7)){a('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',t);return false}return true};var m=e.exports.match=function(e,t){return p.slice(0,-1).reduce(function(n,r,a){if(1==a){if(Number(e[r]||5432)===Number(t[r])){return n&&true}}return n&&('*'===t[r]||t[r]===e[r])},true)};e.exports.getPassword=function(e,t,n){var r,i=t.pipe(new o);var s=function(e){t.destroy();a('WARNING: error on reading file: %s',e);n(undefined)};t.on('error',s);i.on('data',function(t){var n=f(t);if(n&&y(n)&&m(e,n)){r=n[g];i.end()}}).on('end',function(){t.destroy();n(r)}).on('error',s)};var f=e.exports.parseLine=function(e){if(11>e.length||e.match(/^\s+#/)){return null}for(var t='',n='',r=0,a=0,s={},o=false,d=function(t,n,r){var a=e.substring(n,r);if(!Object.hasOwnProperty.call(process.env,'PGPASS_NO_DEESCAPE')){a=a.replace(/\\([:\\])/g,'$1')}s[p[t]]=a},u=0;u<e.length-1;u+=1){t=e.charAt(u+1);n=e.charAt(u);o=r==c-1;if(o){d(r,a);break}if(0<=u&&':'==t&&'\\'!==n){d(r,a,u+1);a=u+2;r+=1}}s=Object.keys(s).length===c?s:null;return s},y=e.exports.isValidEntry=function(e){for(var t={0:function(e){return 0<e.length},1:function(e){if('*'===e){return true}e=Number(e);return isFinite(e)&&0<e&&9007199254740992>e&&Math.floor(e)===e},2:function(e){return 0<e.length},3:function(e){return 0<e.length},4:function(e){return 0<e.length}},n=0;n<p.length;n+=1){var r=t[n],a=e[p[n]]||'',i=r(a);if(!i){return false}}return true}},function(e,t,n){var r=n(41),a=n(11).StringDecoder;e.exports=function(e,t,n){var o=new a,d='',u=n&&n.maxLength,l=n&&false===n.trailing?false:true;if('function'===typeof e)t=e,e=null;if(!e)e=/\r?\n/;function s(e,n){if(t){try{n=t(n)}catch(t){return e.emit('error',t)}if('undefined'!==typeof n)e.queue(n)}else e.queue(n)}function i(t,n){var r=((null!=d?d:'')+n).split(e);d=r.pop();if(u&&d.length>u)return t.emit('error',new Error('maximum buffer reached'));for(var a=0,i;a<r.length;a++){i=r[a];s(t,i)}}return r(function(e){i(this,o.write(e))},function(){if(o.end)i(this,o.end());if(l&&null!=d)s(this,d);this.queue(null)})}},function(e,t,n){var a=n(10);t=e.exports=r;r.through=r;function r(e,t,n){e=e||function(e){this.queue(e)};t=t||function(){this.queue(null)};var s=false,o=false,d=[],u=false,l=new a;l.readable=l.writable=true;l.paused=false;l.autoDestroy=!(n&&false===n.autoDestroy);l.write=function(t){e.call(this,t);return!l.paused};function r(){while(d.length&&!l.paused){var e=d.shift();if(null===e)return l.emit('end');else l.emit('data',e)}}l.queue=l.push=function(e){if(u)return l;if(null===e)u=true;d.push(e);r();return l};l.on('end',function(){l.readable=false;if(!l.writable&&l.autoDestroy)process.nextTick(function(){l.destroy()})});function i(){l.writable=false;t.call(l);if(!l.readable&&l.autoDestroy)l.destroy()}l.end=function(e){if(s)return;s=true;if(arguments.length)l.write(e);i();return l};l.destroy=function(){if(o)return;o=true;s=true;d.length=0;l.writable=l.readable=false;l.emit('close');return l};l.pause=function(){if(l.paused)return;l.paused=true;return l};l.resume=function(){if(l.paused){l.paused=false;l.emit('resume')}r();if(!l.paused)l.emit('drain');return l};return l}},function(e){e.exports=require('dns')},function(e,t,n){'use strict';var r=n(21);e.exports={parse:function(e){var t;if('/'===e.charAt(0)){t=e.split(' ');return{host:t[0],database:t[1]}}if(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(e)){e=encodeURI(e).replace(/\%25(\d\d)/g,'%$1')}var n=r.parse(e,true);t={};if(n.query.application_name){t.application_name=n.query.application_name}if(n.query.fallback_application_name){t.fallback_application_name=n.query.fallback_application_name}t.port=n.port;if('socket:'==n.protocol){t.host=decodeURI(n.pathname);t.database=n.query.db;t.client_encoding=n.query.encoding;return t}t.host=n.hostname;var a=n.pathname;if(a&&'/'===a.charAt(0)){a=n.pathname.slice(1)||null}t.database=a&&decodeURI(a);var i=(n.auth||':').split(':');t.user=i[0];t.password=i.splice(1).join(':');var s=n.query.ssl;if('true'===s||'1'===s){t.ssl=true}return t}}},function(e,t,n){'use strict';var r=n(6).EventEmitter,a=n(5),i=n(45),s=n(13),o=function(e,t,n){if(!(this instanceof o)){return new o(e,t,n)}e=s.normalizeQueryConfig(e,t,n);this.text=e.text;this.values=e.values;this.rows=e.rows;this.types=e.types;this.name=e.name;this.binary=e.binary;this.stream=e.stream;this.portal=e.portal||'';this.callback=e.callback;this._rowMode=e.rowMode;if(process.domain&&e.callback){this.callback=process.domain.bind(e.callback)}this._result=new i(this._rowMode,this.types);this._results=this._result;this.isPreparedStatement=false;this._canceledDueToError=false;this._promise=null;r.call(this)};a.inherits(o,r);o.prototype.requiresPreparation=function(){if(this.name){return true}if(this.rows){return true}if(!this.text){return false}if(!this.values){return false}return 0<this.values.length};o.prototype._checkForMultirow=function(){if(this._result.command){if(!Array.isArray(this._results)){this._results=[this._result]}this._result=new i(this._rowMode,this.types);this._results.push(this._result)}};o.prototype.handleRowDescription=function(e){this._checkForMultirow();this._result.addFields(e.fields);this._accumulateRows=this.callback||!this.listeners('row').length};o.prototype.handleDataRow=function(e){var t;if(this._canceledDueToError){return}try{t=this._result.parseRow(e.fields)}catch(e){this._canceledDueToError=e;return}this.emit('row',t,this._result);if(this._accumulateRows){this._result.addRow(t)}};o.prototype.handleCommandComplete=function(e,t){this._checkForMultirow();this._result.addCommandComplete(e);if(this.isPreparedStatement){t.sync()}};o.prototype.handleEmptyQuery=function(e){if(this.isPreparedStatement){e.sync()}};o.prototype.handleReadyForQuery=function(e){if(this._canceledDueToError){return this.handleError(this._canceledDueToError,e)}if(this.callback){this.callback(null,this._results)}this.emit('end',this._results)};o.prototype.handleError=function(e,t){if(this.isPreparedStatement){t.sync()}if(this._canceledDueToError){e=this._canceledDueToError;this._canceledDueToError=false}if(this.callback){return this.callback(e)}this.emit('error',e)};o.prototype.submit=function(e){if('string'!==typeof this.text&&'string'!==typeof this.name){const t=new Error('A query must have either text or a name. Supplying neither is unsupported.');e.emit('error',t);e.emit('readyForQuery');return}if(this.values&&!Array.isArray(this.values)){const t=new Error('Query values must be an array');e.emit('error',t);e.emit('readyForQuery');return}if(this.requiresPreparation()){this.prepare(e)}else{e.query(this.text)}};o.prototype.hasBeenParsed=function(e){return this.name&&e.parsedStatements[this.name]};o.prototype.handlePortalSuspended=function(e){this._getRows(e,this.rows)};o.prototype._getRows=function(e,t){e.execute({portal:this.portalName,rows:t},true);e.flush()};o.prototype.prepare=function(e){var t=this;this.isPreparedStatement=true;if(!this.hasBeenParsed(e)){e.parse({text:t.text,name:t.name,types:t.types},true)}if(t.values){t.values=t.values.map(s.prepareValue)}e.bind({portal:t.portalName,statement:t.name,values:t.values,binary:t.binary},true);e.describe({type:'P',name:t.portalName||''},true);this._getRows(e,this.rows)};o.prototype.handleCopyInResponse=function(e){if(this.stream)this.stream.startStreamingToConnection(e);else e.sendCopyFail('No source stream defined')};o.prototype.handleCopyData=function(e){var t=e.chunk;if(this.stream){this.stream.handleChunk(t)}};e.exports=o},function(e,t,n){'use strict';var r=n(9),a=n(46),i=function(e){this.command=null;this.rowCount=null;this.oid=null;this.rows=[];this.fields=[];this._parsers=[];this.RowCtor=null;this.rowAsArray='array'===e;if(this.rowAsArray){this.parseRow=this._parseRowAsArray}},s=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;i.prototype.addCommandComplete=function(e){var t;if(e.text){t=s.exec(e.text)}else{t=s.exec(e.command)}if(t){this.command=t[1];if(t[3]){this.oid=parseInt(t[2],10);this.rowCount=parseInt(t[3],10)}else if(t[2]){this.rowCount=parseInt(t[2],10)}}};i.prototype._parseRowAsArray=function(e){for(var t=[],n=0,r=e.length,a;n<r;n++){a=e[n];if(null!==a){t.push(this._parsers[n](a))}else{t.push(null)}}return t};i.prototype.parseRow=function(e){return new this.RowCtor(this._parsers,e)};i.prototype.addRow=function(e){this.rows.push(e)};var o=function(e,t){return'\nthis[\''+a(e)+'\'] = rowData['+t+'] == null ? null : parsers['+t+'](rowData['+t+']);'};i.prototype.addFields=function(e){if(this.fields.length){this.fields=[];this._parsers=[]}for(var t='',n=0,r;n<e.length;n++){r=e[n];this.fields.push(r);var a=this._getTypeParser(r.dataTypeID,r.format||'text');this._parsers.push(a);t+=o(r.name,n)}if(!this.rowAsArray){this.RowCtor=Function('parsers','rowData',t)}};i.prototype._getTypeParser=r.getTypeParser;e.exports=i},function(e){e.exports=function(e){return(''+e).replace(/["'\\\n\r\u2028\u2029]/g,function(e){switch(e){case'"':case'\'':case'\\':return'\\'+e;case'\n':return'\\n';case'\r':return'\\r';case'\u2028':return'\\u2028';case'\u2029':return'\\u2029';}})}},function(e){e.exports=require('net')},function(e){var t=e.exports=function(e){this.size=e||1024;this.buffer=Buffer(this.size+5);this.offset=5;this.headerPosition=0};t.prototype._ensure=function(e){var t=this.buffer.length-this.offset;if(t<e){var n=this.buffer,r=n.length+(n.length>>1)+e;this.buffer=new Buffer(r);n.copy(this.buffer)}};t.prototype.addInt32=function(e){this._ensure(4);this.buffer[this.offset++]=255&e>>>24;this.buffer[this.offset++]=255&e>>>16;this.buffer[this.offset++]=255&e>>>8;this.buffer[this.offset++]=255&e>>>0;return this};t.prototype.addInt16=function(e){this._ensure(2);this.buffer[this.offset++]=255&e>>>8;this.buffer[this.offset++]=255&e>>>0;return this};var n=function(e,t,n,r){e.write(t,n,r)};if(3===Buffer.prototype.write.length){n=function(e,t,n){e.write(t,n)}}t.prototype.addCString=function(e){if(!e){this._ensure(1)}else{var t=Buffer.byteLength(e);this._ensure(t+1);n(this.buffer,e,this.offset,t);this.offset+=t}this.buffer[this.offset++]=0;return this};t.prototype.addChar=function(e){this._ensure(1);n(this.buffer,e,this.offset,1);this.offset++;return this};t.prototype.addString=function(e){e=e||'';var t=Buffer.byteLength(e);this._ensure(t);this.buffer.write(e,this.offset);this.offset+=t;return this};t.prototype.getByteLength=function(){return this.offset-5};t.prototype.add=function(e){this._ensure(e.length);e.copy(this.buffer,this.offset);this.offset+=e.length;return this};t.prototype.clear=function(){this.offset=5;this.headerPosition=0;this.lastEnd=0};t.prototype.addHeader=function(e,t){var n=this.offset;this.offset=this.headerPosition;this.buffer[this.offset++]=e;this.addInt32(n-(this.headerPosition+1));this.headerPosition=n;this.offset=n;if(!t){this._ensure(5);this.offset+=5}};t.prototype.join=function(e){if(e){this.addHeader(e,true)}return this.buffer.slice(e?0:5,this.offset)};t.prototype.flush=function(e){var t=this.join(e);this.clear();return t}},function(e,t,n){var r=n(23),a=e.exports=function(e){if('number'==typeof e){e={headerSize:e}}e=e||{};this.offset=0;this.lastChunk=false;this.chunk=null;this.chunkLength=0;this.headerSize=e.headerSize||0;this.lengthPadding=e.lengthPadding||0;this.header=null;r(2>this.headerSize,'pre-length header of more than 1 byte length not currently supported')};a.prototype.addChunk=function(e){if(!this.chunk||this.offset===this.chunkLength){this.chunk=e;this.chunkLength=e.length;this.offset=0;return}var t=e.length,n=this.chunkLength+t;if(n>this.chunk.length){var r=2*this.chunk.length;while(n>=r){r*=2}var a=new Buffer(r);this.chunk.copy(a);this.chunk=a}e.copy(this.chunk,this.chunkLength);this.chunkLength=n};a.prototype.read=function(){if(this.chunkLength<this.headerSize+4+this.offset){return false}if(this.headerSize){this.header=this.chunk[this.offset]}var e=this.chunk.readUInt32BE(this.offset+this.headerSize)+this.lengthPadding,t=this.chunkLength-(this.offset+4+this.headerSize);if(e>t){return false}this.offset+=this.headerSize+4;var n=this.chunk.slice(this.offset,this.offset+e);this.offset+=e;return n}},function(e){e.exports=require('tls')},function(e,t,n){'use strict';const s=n(6).EventEmitter,o=function(){},d=(e,t)=>{const n=e.findIndex(t);return-1===n?undefined:e.splice(n,1)[0]};class u{constructor(e,t){this.client=e;this.timeoutId=t}}function r(){throw new Error('Release called on client which has already been released to the pool.')}function a(e,t){e.release=r;if(t||this.ending){this._remove(e);this._pulseQueue();return}let n;if(this.options.idleTimeoutMillis){n=setTimeout(()=>{this.log('remove idle client');this._remove(e)},this.options.idleTimeoutMillis)}this._idle.push(new u(e,n));this._pulseQueue()}function i(e,t){if(t){return{callback:t,result:undefined}}let n,r;const a=new e(function(e,t){r=e;n=t});return{callback:function(e,t){e?n(e):r(t)},result:a}}class l extends s{constructor(e,t){super();this.options=Object.assign({},e);this.options.max=this.options.max||this.options.poolSize||10;this.log=this.options.log||function(){};this.Client=this.options.Client||t||n(16).Client;this.Promise=this.options.Promise||global.Promise;if('undefined'===typeof this.options.idleTimeoutMillis){this.options.idleTimeoutMillis=1e4}this._clients=[];this._idle=[];this._pendingQueue=[];this._endCallback=undefined;this.ending=false}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){this.log('pulse queue');if(this.ending){this.log('pulse queue on ending');if(this._idle.length){this._idle.slice().map((e)=>{this._remove(e.client)})}if(!this._clients.length){this._endCallback()}return}if(!this._pendingQueue.length){this.log('no queued requests');return}if(!this._idle.length&&this._isFull()){return}const e=this._pendingQueue.shift();if(this._idle.length){const t=this._idle.pop();clearTimeout(t.timeoutId);const n=t.client;n.release=a.bind(this,n);this.emit('acquire',n);return e(undefined,n,n.release)}if(!this._isFull()){return this.connect(e)}throw new Error('unexpected condition')}_remove(e){const t=d(this._idle,(t)=>t.client===e);if(t!==undefined){clearTimeout(t.timeoutId)}this._clients=this._clients.filter((t)=>t!==e);e.end();this.emit('remove',e)}connect(e){if(this.ending){const t=new Error('Cannot use a pool after calling end on the pool');return e?e(t):this.Promise.reject(t)}if(this._clients.length>=this.options.max||this._idle.length){const t=i(this.Promise,e),n=t.result;if(this._idle.length){process.nextTick(()=>this._pulseQueue())}if(!this.options.connectionTimeoutMillis){this._pendingQueue.push(t.callback);return n}const r=setTimeout(()=>{this._pendingQueue=this._pendingQueue.filter((e)=>e===t.callback);t.callback(new Error('timeout exceeded when trying to connect'))},this.options.connectionTimeoutMillis);this._pendingQueue.push(function(e,n,a){clearTimeout(r);t.callback(e,n,a)});return n}const t=new this.Client(this.options);this._clients.push(t);const n=(e)=>{e.client=t;t.removeListener('error',n);t.on('error',()=>{this.log('additional client error after disconnection due to error',e)});this._remove(t);this.emit('error',e,t)};this.log('connecting new client');let r,s=false;if(this.options.connectionTimeoutMillis){r=setTimeout(()=>{this.log('ending client due to timeout');s=true;t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)}const d=i(this.Promise,e);e=d.callback;this.log('connecting new client');t.connect((i)=>{this.log('new client connected');if(r){clearTimeout(r)}t.on('error',n);if(i){this._clients=this._clients.filter((e)=>e!==t);if(s){i.message='Connection terminiated due to connection timeout'}e(i,undefined,o)}else{t.release=a.bind(this,t);this.emit('connect',t);this.emit('acquire',t);if(this.options.verify){this.options.verify(t,e)}else{e(undefined,t,t.release)}}});return d.result}query(e,t,n){if('function'===typeof e){const t=i(this.Promise,e);setImmediate(function(){return t.callback(new Error('Passing a function as the first parameter to pool.query is not supported'))});return t.result}if('function'===typeof t){n=t;t=undefined}const r=i(this.Promise,n);n=r.callback;this.connect((r,a)=>{if(r){return n(r)}this.log('dispatching query');a.query(e,t,(e,t)=>{this.log('query dispatched');a.release(e);if(e){return n(e)}else{return n(undefined,t)}})});return r.result}end(e){this.log('ending');if(this.ending){const t=new Error('Called end on pool more than once');return e?e(t):this.Promise.reject(t)}this.ending=true;const t=i(this.Promise,e);this._endCallback=t.callback;this._pulseQueue();return t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get totalCount(){return this._clients.length}}e.exports=l},function(e,t,n){'use strict';var r=n(!function(){var t=new Error('Cannot find module "pg-native"');t.code='MODULE_NOT_FOUND';throw t}()),a=n(19),i=n(53),s=n(54),o=n(23),d=n(6).EventEmitter,u=n(5),l=n(20),p='Version >= '+s.minNativeVersion+' of pg-native required.';o(i.gte(r.version,s.minNativeVersion),p);var c=n(55),g=e.exports=function(e){d.call(this);e=e||{};this._types=new a(e.types);this.native=new r({types:this._types});this._queryQueue=[];this._connected=false;this._connecting=false;var t=this.connectionParameters=new l(e);this.user=t.user;this.password=t.password;this.database=t.database;this.host=t.host;this.port=t.port;this.namedQueries={}};g.Query=c;u.inherits(g,d);g.prototype.connect=function(e){var t=this,n=function(n){if(e)return e(n);return t.emit('error',n)},r;if(!e){var a,i;e=(e)=>e?i(e):a();r=new global.Promise(function(e,t){a=e;i=t})}if(this._connecting){process.nextTick(()=>e(new Error('Client has already been connected. You cannot reuse a client.')));return r}this._connecting=true;this.connectionParameters.getLibpqConnectionString(function(r,a){if(r)return n(r);t.native.connect(a,function(r){if(r)return n(r);t._connected=true;t.native.on('error',function(e){if(t._activeQuery&&'end'!==t._activeQuery.state){return}t.emit('error',e)});t.native.on('notification',function(e){t.emit('notification',{channel:e.relname,payload:e.extra})});t.emit('connect');t._pulseQueryQueue(true);if(e)e()})});return r};g.prototype.query=function(e,t,n){if('function'===typeof e.submit){if('function'===typeof t){e.callback=t}this._queryQueue.push(e);this._pulseQueryQueue();return e}var r=new c(e,t,n),a;if(!r.callback){let e,t;a=new Promise((n,r)=>{e=n;t=r});r.callback=(n,r)=>n?t(n):e(r)}this._queryQueue.push(r);this._pulseQueryQueue();return a};g.prototype.end=function(e){var t=this;if(!this._connected){this.once('connect',this.end.bind(this,e))}var n;if(!e){var r,a;e=(e)=>e?a(e):r();n=new global.Promise(function(e,t){r=e;a=t})}this.native.end(function(){if(t._hasActiveQuery()){t._queryQueue.length=0;t._activeQuery.handleError(new Error('Connection terminated'))}t.emit('end');if(e)e()});return n};g.prototype._hasActiveQuery=function(){return this._activeQuery&&'error'!==this._activeQuery.state&&'end'!==this._activeQuery.state};g.prototype._pulseQueryQueue=function(e){if(!this._connected){return}if(this._hasActiveQuery()){return}var t=this._queryQueue.shift();if(!t){if(!e){this.emit('drain')}return}this._activeQuery=t;t.submit(this);var n=this;t.once('_done',function(){n._pulseQueryQueue()})};g.prototype.cancel=function(e){if(this._activeQuery===e){this.native.cancel(function(){})}else if(-1!==this._queryQueue.indexOf(e)){this._queryQueue.splice(this._queryQueue.indexOf(e),1)}};g.prototype.setTypeParser=function(e,t,n){return this._types.setTypeParser(e,t,n)};g.prototype.getTypeParser=function(e,t){return this._types.getTypeParser(e,t)}},function(e,t,n){var D,P;if('object'===typeof e&&e.exports===t)t=e.exports=s;var q;if('object'===typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG))q=function(){var e=Array.prototype.slice.call(arguments,0);e.unshift('SEMVER');console.log.apply(console,e)};else q=function(){};t.SEMVER_SPEC_VERSION='2.0.0';var k=256,N=Number.MAX_SAFE_INTEGER||9007199254740991,L=t.re=[],M=t.src=[],U=0,R=U++;M[R]='0|[1-9]\\d*';var F=U++;M[F]='[0-9]+';var Q=U++;M[Q]='\\d*[a-zA-Z-][a-zA-Z0-9-]*';var $=U++;M[$]='('+M[R]+')\\.('+M[R]+')\\.('+M[R]+')';var H=U++;M[H]='('+M[F]+')\\.('+M[F]+')\\.('+M[F]+')';var G=U++;M[G]='(?:'+M[R]+'|'+M[Q]+')';var V=U++;M[V]='(?:'+M[F]+'|'+M[Q]+')';var B=U++;M[B]='(?:-('+M[G]+'(?:\\.'+M[G]+')*))';var z=U++;M[z]='(?:-?('+M[V]+'(?:\\.'+M[V]+')*))';var X=U++;M[X]='[0-9A-Za-z-]+';var W=U++;M[W]='(?:\\+('+M[X]+'(?:\\.'+M[X]+')*))';var Y=U++,K='v?'+M[$]+M[B]+'?'+M[W]+'?';M[Y]='^'+K+'$';var Z='[v=\\s]*'+M[H]+M[z]+'?'+M[W]+'?',J=U++;M[J]='^'+Z+'$';var ee=U++;M[ee]='((?:<|>)?=?)';var te=U++;M[te]=M[F]+'|x|X|\\*';var ne=U++;M[ne]=M[R]+'|x|X|\\*';var re=U++;M[re]='[v=\\s]*('+M[ne]+')(?:\\.('+M[ne]+')(?:\\.('+M[ne]+')(?:'+M[B]+')?'+M[W]+'?)?)?';var ae=U++;M[ae]='[v=\\s]*('+M[te]+')(?:\\.('+M[te]+')(?:\\.('+M[te]+')(?:'+M[z]+')?'+M[W]+'?)?)?';var ie=U++;M[ie]='^'+M[ee]+'\\s*'+M[re]+'$';var se=U++;M[se]='^'+M[ee]+'\\s*'+M[ae]+'$';var oe=U++;M[oe]='(?:~>?)';var de=U++;M[de]='(\\s*)'+M[oe]+'\\s+';L[de]=new RegExp(M[de],'g');var ue=U++;M[ue]='^'+M[oe]+M[re]+'$';var le=U++;M[le]='^'+M[oe]+M[ae]+'$';var pe=U++;M[pe]='(?:\\^)';var ce=U++;M[ce]='(\\s*)'+M[pe]+'\\s+';L[ce]=new RegExp(M[ce],'g');var ge=U++;M[ge]='^'+M[pe]+M[re]+'$';var me=U++;M[me]='^'+M[pe]+M[ae]+'$';var fe=U++;M[fe]='^'+M[ee]+'\\s*('+Z+')$|^$';var ye=U++;M[ye]='^'+M[ee]+'\\s*('+K+')$|^$';var be=U++;M[be]='(\\s*)'+M[ee]+'\\s*('+Z+'|'+M[re]+')';L[be]=new RegExp(M[be],'g');var he=U++;M[he]='^\\s*('+M[re]+')\\s+-\\s+('+M[re]+')\\s*$';var we=U++;M[we]='^\\s*('+M[ae]+')\\s+-\\s+('+M[ae]+')\\s*$';var ve=U++;M[ve]='(<|>)?=?\\s*\\*';for(var _e=0;_e<U;_e++){q(_e,M[_e]);if(!L[_e])L[_e]=new RegExp(M[_e])}t.parse=r;function r(e,t){if(e.length>k)return null;var n=t?L[J]:L[Y];if(!n.test(e))return null;try{return new s(e,t)}catch(e){return null}}t.valid=function(e,t){var n=r(e,t);return n?n.version:null};t.clean=function(e,t){var n=r(e.trim().replace(/^[=v]+/,''),t);return n?n.version:null};t.SemVer=s;function s(e,t){if(e instanceof s){if(e.loose===t)return e;else e=e.version}else if('string'!==typeof e){throw new TypeError('Invalid Version: '+e)}if(e.length>k)throw new TypeError('version is longer than '+k+' characters');if(!(this instanceof s))return new s(e,t);q('SemVer',e,t);this.loose=t;var n=e.trim().match(t?L[J]:L[Y]);if(!n)throw new TypeError('Invalid Version: '+e);this.raw=e;this.major=+n[1];this.minor=+n[2];this.patch=+n[3];if(this.major>N||0>this.major)throw new TypeError('Invalid major version');if(this.minor>N||0>this.minor)throw new TypeError('Invalid minor version');if(this.patch>N||0>this.patch)throw new TypeError('Invalid patch version');if(!n[4])this.prerelease=[];else this.prerelease=n[4].split('.').map(function(e){return /^[0-9]+$/.test(e)?+e:e});this.build=n[5]?n[5].split('.'):[];this.format()}s.prototype.format=function(){this.version=this.major+'.'+this.minor+'.'+this.patch;if(this.prerelease.length)this.version+='-'+this.prerelease.join('.');return this.version};s.prototype.inspect=function(){return'<SemVer "'+this+'">'};s.prototype.toString=function(){return this.version};s.prototype.compare=function(e){q('SemVer.compare',this.version,this.loose,e);if(!(e instanceof s))e=new s(e,this.loose);return this.compareMain(e)||this.comparePre(e)};s.prototype.compareMain=function(e){if(!(e instanceof s))e=new s(e,this.loose);return o(this.major,e.major)||o(this.minor,e.minor)||o(this.patch,e.patch)};s.prototype.comparePre=function(e){if(!(e instanceof s))e=new s(e,this.loose);if(this.prerelease.length&&!e.prerelease.length)return-1;else if(!this.prerelease.length&&e.prerelease.length)return 1;else if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var n=this.prerelease[t],r=e.prerelease[t];q('prerelease compare',t,n,r);if(n===undefined&&r===undefined)return 0;else if(r===undefined)return 1;else if(n===undefined)return-1;else if(n===r)continue;else return o(n,r)}while(++t)};s.prototype.inc=function(e,t){switch(e){case'premajor':this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc('pre',t);break;case'preminor':this.prerelease.length=0;this.patch=0;this.minor++;this.inc('pre',t);break;case'prepatch':this.prerelease.length=0;this.inc('patch',t);this.inc('pre',t);break;case'prerelease':if(0===this.prerelease.length)this.inc('patch',t);this.inc('pre',t);break;case'major':if(0!==this.minor||0!==this.patch||0===this.prerelease.length)this.major++;this.minor=0;this.patch=0;this.prerelease=[];break;case'minor':if(0!==this.patch||0===this.prerelease.length)this.minor++;this.patch=0;this.prerelease=[];break;case'patch':if(0===this.prerelease.length)this.patch++;this.prerelease=[];break;case'pre':if(0===this.prerelease.length)this.prerelease=[0];else{var n=this.prerelease.length;while(0<=--n){if('number'===typeof this.prerelease[n]){this.prerelease[n]++;n=-2}}if(-1===n)this.prerelease.push(0)}if(t){if(this.prerelease[0]===t){if(isNaN(this.prerelease[1]))this.prerelease=[t,0]}else this.prerelease=[t,0]}break;default:throw new Error('invalid increment argument: '+e);}this.format();return this};t.inc=function(e,t,n,r){if('string'===typeof n){r=n;n=undefined}try{return new s(e,n).inc(t,r).version}catch(e){return null}};t.diff=function(e,t){if(c(e,t)){return null}else{var n=r(e),a=r(t);if(n.prerelease.length||a.prerelease.length){for(var i in n){if('major'===i||'minor'===i||'patch'===i){if(n[i]!==a[i]){return'pre'+i}}}return'prerelease'}for(var i in n){if('major'===i||'minor'===i||'patch'===i){if(n[i]!==a[i]){return i}}}}};t.compareIdentifiers=o;var i=/^[0-9]+$/;function o(e,t){var n=i.test(e),r=i.test(t);if(n&&r){e=+e;t=+t}return n&&!r?-1:r&&!n?1:e<t?-1:e>t?1:0}t.rcompareIdentifiers=function(e,t){return o(t,e)};t.major=function(e,t){return new s(e,t).major};t.minor=function(e,t){return new s(e,t).minor};t.patch=function(e,t){return new s(e,t).patch};t.compare=d;function d(e,t,n){return new s(e,n).compare(t)}t.compareLoose=function(e,t){return d(e,t,true)};t.rcompare=u;function u(e,t,n){return d(t,e,n)}t.sort=function(e,n){return e.sort(function(e,r){return t.compare(e,r,n)})};t.rsort=function(e,n){return e.sort(function(e,r){return t.rcompare(e,r,n)})};t.gt=l;function l(e,t,n){return 0<d(e,t,n)}t.lt=p;function p(e,t,n){return 0>d(e,t,n)}t.eq=c;function c(e,t,n){return 0===d(e,t,n)}t.neq=g;function g(e,t,n){return 0!==d(e,t,n)}t.gte=m;function m(e,t,n){return 0<=d(e,t,n)}t.lte=f;function f(e,t,n){return 0>=d(e,t,n)}t.cmp=a;function a(e,t,n,r){var i;switch(t){case'===':if('object'===typeof e)e=e.version;if('object'===typeof n)n=n.version;i=e===n;break;case'!==':if('object'===typeof e)e=e.version;if('object'===typeof n)n=n.version;i=e!==n;break;case'':case'=':case'==':i=c(e,n,r);break;case'!=':i=g(e,n,r);break;case'>':i=l(e,n,r);break;case'>=':i=m(e,n,r);break;case'<':i=p(e,n,r);break;case'<=':i=f(e,n,r);break;default:throw new TypeError('Invalid operator: '+t);}return i}t.Comparator=y;function y(e,t){if(e instanceof y){if(e.loose===t)return e;else e=e.value}if(!(this instanceof y))return new y(e,t);q('comparator',e,t);this.loose=t;this.parse(e);if(this.semver===Ee)this.value='';else this.value=this.operator+this.semver.version;q('comp',this)}var Ee={};y.prototype.parse=function(e){var t=this.loose?L[fe]:L[ye],n=e.match(t);if(!n)throw new TypeError('Invalid comparator: '+e);this.operator=n[1];if('='===this.operator)this.operator='';if(!n[2])this.semver=Ee;else this.semver=new s(n[2],this.loose)};y.prototype.inspect=function(){return'<SemVer Comparator "'+this+'">'};y.prototype.toString=function(){return this.value};y.prototype.test=function(e){q('Comparator.test',e,this.loose);if(this.semver===Ee)return true;if('string'===typeof e)e=new s(e,this.loose);return a(e,this.operator,this.semver,this.loose)};t.Range=b;function b(e,t){if(e instanceof b&&e.loose===t)return e;if(!(this instanceof b))return new b(e,t);this.loose=t;this.raw=e;this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length});if(!this.set.length){throw new TypeError('Invalid SemVer Range: '+e)}this.format()}b.prototype.inspect=function(){return'<SemVer Range "'+this.range+'">'};b.prototype.format=function(){this.range=this.set.map(function(e){return e.join(' ').trim()}).join('||').trim();return this.range};b.prototype.toString=function(){return this.range};b.prototype.parseRange=function(e){var t=this.loose;e=e.trim();q('range',e,t);var n=t?L[we]:L[he];e=e.replace(n,A);q('hyphen replace',e);e=e.replace(L[be],'$1$2$3');q('comparator trim',e,L[be]);e=e.replace(L[de],'$1~');e=e.replace(L[ce],'$1^');e=e.split(/\s+/).join(' ');var r=t?L[fe]:L[ye],a=e.split(' ').map(function(e){return h(e,t)}).join(' ').split(/\s+/);if(this.loose){a=a.filter(function(e){return!!e.match(r)})}a=a.map(function(e){return new y(e,t)});return a};t.toComparators=function(e,t){return new b(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(' ').trim().split(' ')})};function h(e,t){q('comp',e);e=E(e,t);q('caret',e);e=v(e,t);q('tildes',e);e=I(e,t);q('xrange',e);e=T(e,t);q('stars',e);return e}function w(e){return!e||'x'===e.toLowerCase()||'*'===e}function v(e,t){return e.trim().split(/\s+/).map(function(e){return _(e,t)}).join(' ')}function _(e,t){var n=t?L[le]:L[ue];return e.replace(n,function(t,n,r,a,i){q('tilde',e,t,n,r,a,i);var s;if(w(n))s='';else if(w(r))s='>='+n+'.0.0 <'+(+n+1)+'.0.0';else if(w(a))s='>='+n+'.'+r+'.0 <'+n+'.'+(+r+1)+'.0';else if(i){q('replaceTilde pr',i);if('-'!==i.charAt(0))i='-'+i;s='>='+n+'.'+r+'.'+a+i+' <'+n+'.'+(+r+1)+'.0'}else s='>='+n+'.'+r+'.'+a+' <'+n+'.'+(+r+1)+'.0';q('tilde return',s);return s})}function E(e,t){return e.trim().split(/\s+/).map(function(e){return O(e,t)}).join(' ')}function O(e,t){q('caret',e,t);var n=t?L[me]:L[ge];return e.replace(n,function(t,n,r,a,i){q('caret',e,t,n,r,a,i);var s;if(w(n))s='';else if(w(r))s='>='+n+'.0.0 <'+(+n+1)+'.0.0';else if(w(a)){if('0'===n)s='>='+n+'.'+r+'.0 <'+n+'.'+(+r+1)+'.0';else s='>='+n+'.'+r+'.0 <'+(+n+1)+'.0.0'}else if(i){q('replaceCaret pr',i);if('-'!==i.charAt(0))i='-'+i;if('0'===n){if('0'===r)s='>='+n+'.'+r+'.'+a+i+' <'+n+'.'+r+'.'+(+a+1);else s='>='+n+'.'+r+'.'+a+i+' <'+n+'.'+(+r+1)+'.0'}else s='>='+n+'.'+r+'.'+a+i+' <'+(+n+1)+'.0.0'}else{q('no pr');if('0'===n){if('0'===r)s='>='+n+'.'+r+'.'+a+' <'+n+'.'+r+'.'+(+a+1);else s='>='+n+'.'+r+'.'+a+' <'+n+'.'+(+r+1)+'.0'}else s='>='+n+'.'+r+'.'+a+' <'+(+n+1)+'.0.0'}q('caret return',s);return s})}function I(e,t){q('replaceXRanges',e,t);return e.split(/\s+/).map(function(e){return S(e,t)}).join(' ')}function S(e,t){e=e.trim();var n=t?L[se]:L[ie];return e.replace(n,function(t,n,r,a,i,s){q('xRange',e,t,n,r,a,i,s);var o=w(r),d=o||w(a),u=d||w(i),l=u;if('='===n&&l)n='';if(o){if('>'===n||'<'===n){t='<0.0.0'}else{t='*'}}else if(n&&l){if(d)a=0;if(u)i=0;if('>'===n){n='>=';if(d){r=+r+1;a=0;i=0}else if(u){a=+a+1;i=0}}else if('<='===n){n='<';if(d)r=+r+1;else a=+a+1}t=n+r+'.'+a+'.'+i}else if(d){t='>='+r+'.0.0 <'+(+r+1)+'.0.0'}else if(u){t='>='+r+'.'+a+'.0 <'+r+'.'+(+a+1)+'.0'}q('xRange return',t);return t})}function T(e,t){q('replaceStars',e,t);return e.trim().replace(L[ve],'')}function A(e,t,n,r,a,i,s,o,d,u,l,p){if(w(n))t='';else if(w(r))t='>='+n+'.0.0';else if(w(a))t='>='+n+'.'+r+'.0';else t='>='+t;if(w(d))o='';else if(w(u))o='<'+(+d+1)+'.0.0';else if(w(l))o='<'+d+'.'+(+u+1)+'.0';else if(p)o='<='+d+'.'+u+'.'+l+'-'+p;else o='<='+o;return(t+' '+o).trim()}b.prototype.test=function(e){if(!e)return false;if('string'===typeof e)e=new s(e,this.loose);for(var t=0;t<this.set.length;t++){if(C(this.set[t],e))return true}return false};function C(e,t){for(var n=0;n<e.length;n++){if(!e[n].test(t))return false}if(t.prerelease.length){for(var n=0;n<e.length;n++){q(e[n].semver);if(e[n].semver===Ee)return true;if(0<e[n].semver.prerelease.length){var r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return true}}return false}return true}t.satisfies=j;function j(e,t,n){try{t=new b(t,n)}catch(e){return false}return t.test(e)}t.maxSatisfying=function(e,t,n){return e.filter(function(e){return j(e,t,n)}).sort(function(e,t){return u(e,t,n)})[0]||null};t.validRange=function(e,t){try{return new b(e,t).range||'*'}catch(e){return null}};t.ltr=function(e,t,n){return x(e,t,'<',n)};t.gtr=function(e,t,n){return x(e,t,'>',n)};t.outside=x;function x(e,t,n,r){e=new s(e,r);t=new b(t,r);var a,o,d,u,c;switch(n){case'>':a=l;o=f;d=p;u='>';c='>=';break;case'<':a=p;o=m;d=l;u='<';c='<=';break;default:throw new TypeError('Must provide a hilo val of "<" or ">"');}if(j(e,t,r)){return false}for(var g=0;g<t.set.length;++g){var i=t.set[g],y=null,h=null;i.forEach(function(e){y=y||e;h=h||e;if(a(e.semver,y.semver,r)){y=e}else if(d(e.semver,h.semver,r)){h=e}});if(y.operator===u||y.operator===c){return false}if((!h.operator||h.operator===u)&&o(e,h.semver)){return false}else if(h.operator===c&&d(e,h.semver)){return false}}return true}!(D=t,P='function'===typeof D?D.call(t,n,t,e):D,P!==undefined&&(e.exports=P))},function(e){e.exports={_from:'pg@^7.4.0',_id:'pg@7.4.0',_inBundle:false,_integrity:'sha1-4lYGHSxScjw8hY3vuX8RWcpmD4M=',_location:'/pg',_phantomChildren:{},_requested:{type:'range',registry:true,raw:'pg@^7.4.0',name:'pg',escapedName:'pg',rawSpec:'^7.4.0',saveSpec:null,fetchSpec:'^7.4.0'},_requiredBy:['/'],_resolved:'https://registry.npmjs.org/pg/-/pg-7.4.0.tgz',_shasum:'e256061d2c52723c3c858defb97f1159ca660f83',_spec:'pg@^7.4.0',_where:'/Users/wisdman/Projects/bitjournal',author:{name:'Brian Carlson',email:'brian.m.carlson@gmail.com'},bugs:{url:'https://github.com/brianc/node-postgres/issues'},bundleDependencies:false,dependencies:{"buffer-writer":'1.0.1',"js-string-escape":'1.0.1',"packet-reader":'0.3.1',"pg-connection-string":'0.1.3',"pg-pool":'~2.0.3',"pg-types":'~1.12.1',pgpass:'1.x',semver:'4.3.2'},deprecated:false,description:'PostgreSQL client - pure javascript & libpq with the same API',devDependencies:{async:'0.9.0',co:'4.6.0',eslint:'4.2.0',"eslint-config-standard":'10.2.1',"eslint-plugin-import":'2.7.0',"eslint-plugin-node":'5.1.0',"eslint-plugin-promise":'3.5.0',"eslint-plugin-standard":'3.0.1',"pg-copy-streams":'0.3.0'},engines:{node:'>= 4.5.0'},homepage:'http://github.com/brianc/node-postgres',keywords:['database','libpq','pg','postgre','postgres','postgresql','rdbms'],license:'MIT',main:'./lib',minNativeVersion:'2.0.0',name:'pg',repository:{type:'git',url:'git://github.com/brianc/node-postgres.git'},scripts:{test:'make test-all'},version:'7.4.0'}},function(e,t,n){'use strict';var r=n(6).EventEmitter,a=n(5),i=n(13),s=e.exports=function(e,t,n){r.call(this);e=i.normalizeQueryConfig(e,t,n);this.text=e.text;this.values=e.values;this.name=e.name;this.callback=e.callback;this.state='new';this._arrayMode='array'===e.rowMode;this._emitRowEvents=false;this.on('newListener',function(e){if('row'===e)this._emitRowEvents=true}.bind(this))};a.inherits(s,r);var o={sqlState:'code',statementPosition:'position',messagePrimary:'message',context:'where',schemaName:'schema',tableName:'table',columnName:'column',dataTypeName:'dataType',constraintName:'constraint',sourceFile:'file',sourceLine:'line',sourceFunction:'routine'};s.prototype.handleError=function(e){var t=this.native.pq.resultErrorFields();if(t){for(var n in t){var r=o[n]||n;e[r]=t[n]}}if(this.callback){this.callback(e)}else{this.emit('error',e)}this.state='error'};s.prototype.then=function(e,t){return this._getPromise().then(e,t)};s.prototype.catch=function(e){return this._getPromise().catch(e)};s.prototype._getPromise=function(){if(this._promise)return this._promise;this._promise=new Promise(function(e,t){this._once('end',e);this._once('error',t)}.bind(this));return this._promise};s.prototype.submit=function(e){this.state='running';var t=this;this.native=e.native;e.native.arrayMode=this._arrayMode;var n=function(n,r,a){e.native.arrayMode=false;setImmediate(function(){t.emit('_done')});if(n){return t.handleError(n)}if(t._emitRowEvents){if(1<a.length){r.forEach((e,n)=>{e.forEach((e)=>{t.emit('row',e,a[n])})})}else{r.forEach(function(e){t.emit('row',e,a)})}}t.state='end';t.emit('end',a);if(t.callback){t.callback(null,a)}};if(process.domain){n=process.domain.bind(n)}if(this.name){if(63<this.name.length){console.error('Warning! Postgres only supports 63 characters for query names.');console.error('You supplied',this.name,'(',this.name.length,')');console.error('This can cause conflicts and silent errors executing queries')}var r=(this.values||[]).map(i.prepareValue);if(e.namedQueries[this.name]){return e.native.execute(this.name,r,n)}return e.native.prepare(this.name,this.text,r.length,function(a){if(a)return n(a);e.namedQueries[t.name]=true;return t.native.execute(t.name,r,n)})}else if(this.values){if(!Array.isArray(this.values)){const e=new Error('Query values must be an array');return n(e)}var a=this.values.map(i.prepareValue);e.native.query(this.text,a,n)}else{e.native.query(this.text,n)}}},function(e,t,n){'use strict';var s=Number.parseFloat,o=Math.floor,d=Number.isNaN,u=Math.max,l=n(1);class p{constructor(){}static*[Symbol.iterator](){const e=Object.keys(this);for(let t of e){yield this[t]}}static parseError(e){const t=e&&parseInt(e.code)||NaN;if(!t)return NaN;for(let n of this)if(n===t)return n;return NaN}}p.UNIQUE_VIOLATION=23505;p.UNDEFINED_OBJECT=42704;class c{constructor(e){this.name=e}valueOf(){return{text:this.text,values:this.values}}}class g{constructor(e=null,t=0,n=[]){this.text='';this.values=[];if(null===e){this.values=[];this.text='';return this}if('string'===typeof e){let r=t;this.values=[];this.text=' WHERE '+e.replace(/\$\d+/g,(e)=>{let t=~~/\d+/.exec(e)[0]-1;if(n[t]===undefined)return'DEFAULT';this.values.push(n[t]);return`$${++r}`});return this}throw new TypeError('value is not a null, array, object or string')}}class m{constructor(e=null){if(null===e){this.text='';return this}if(Array.isArray(e)){this.text=' ORDER BY '+e.map((e)=>`"${e}" ASC`).join(', ');return this}if('object'===typeof e){let t=Object.keys(e);if(0===t.length){this.text='';return this}this.text=' ORDER BY '+t.map((t)=>`"${t}" ${e[t]}`).join(', ');return this}if('string'===typeof e){this.text=` ORDER BY "${e}" ASC`;return this}throw new TypeError('value is not a null, array, object or string')}}class f{constructor(e=Infinity){if(d(e))throw new TypeError('limit is not a number');if(0>=e)throw new TypeError('limit is less than or equal to zero');if(e<Infinity)this.text=` LIMIT ${e}`;else this.text=''}}class y{constructor(e=0){if(d(e))throw new TypeError('offset is not a number');if(0>e)throw new TypeError('offset is less than zero');if(e===Infinity)throw new TypeError('offset is Infinity');if(0<e)this.text=' OFFSET ${offset}';else this.text=''}}class b extends c{constructor(e,t=[]){super('SELECT');this._where=new g;this._order=new m;this._limit=new f;this._offset=new y;let n=Array.isArray(t)?t:Object.keys(t);n=n.map((e)=>`"${e}"`);this._command=`SELECT ${n.join(', ')||'*'} FROM "${e.scheme}"."${e.table}"`}where(e,...t){this._where=new g(e,0,t);return this}order(e){this._order=new m(e);return this}limit(e){this._limit=new f(e);return this}offset(e){this._offset=new y(e);return this}get text(){return this._command+this._where.text+this._order.text+this._limit.text+this._offset.text}get values(){return this._where.values}}class h{constructor(e=[]){let t=Array.isArray(e)?e:Object.keys(e);t=t.map((e)=>`"${e}"`);this.text=` RETURNING ${t.join(', ')||'*'}`}}class w extends c{constructor(e,t={}){super('INSERT');this._returning=new h;let n=Object.keys(t);if(0===n.length)throw new TypeError('filtred value is an empty object');this.values=[];let r=[];n.forEach((e)=>{if(t[e]===undefined){r.push('DEFAULT');return}let n=this.values.push(t[e]);r.push(`$${n}`)});n=n.map((e)=>`"${e}"`);this._command=`INSERT INTO "${e.scheme}"."${e.table}" (${n.join(', ')}) VALUES (${r.join(', ')})`}returning(e){this._returning=new h(e);return this}get text(){return this._command+this._returning.text}}class v extends c{constructor(e,t=[]){super('UPDATE');this._returning=new h;this._where=new g;let n=Object.keys(t);if(0===n.length)throw new TypeError('filtred value is an empty object');this._values=[];n=n.map((e)=>{let n=`"${e}" = `;if(t[e]===undefined){return n+'DEFAULT'}let r=this._values.push(t[e]);return n+`$${r}`});this._command=`UPDATE "${e.scheme}"."${e.table}" SET ${n.join(', ')}`}where(e,...t){this._where=new g(e,this._values.length,t);return this}returning(e){this._returning=new h(e);return this}get text(){return this._command+this._where.text+this._returning.text}get values(){return[...this._values,...this._where.values]}}class _ extends c{constructor(e){super('DELETE');this._where=new g;this._returning=new h;this._command=`DELETE FROM "${e.scheme}"."${e.table}"`}where(e,...t){this._where=new g(e,0,t);return this}returning(e){this._returning=new h(e);return this}get text(){return this._command+this._where.text+this._returning.text}get values(){return this._where.values}}class E{constructor(e,t='public'){this.table=e;this.scheme=t}select(e){return new b(this,e)}insert(e){return new w(this,e)}update(e){return new v(this,e)}delete(){return new _(this)}}var O=n(0),I=n(3),S=n(2),T=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},A=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const C='ads',j='ads';class x extends l.g{async getAll(e){const t=e.db,n=new E(j).select(S.a.MainFields);e.debug(`=== SQL Query [GET /${C}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${C}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.a(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(j).select(S.a.MainFields).where('enable');e.debug(`=== SQL Query [GET /${C}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${C}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.a(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(j).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${C}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${C}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.a(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(j).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${C}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${C}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.a(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${j}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${C}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${C}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.a(n),a=new E(j).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${C}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${C}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.a(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.a(a),s=new E(j).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${C}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${C}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.a(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(j).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${C}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${C}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.a(i.rows[0]);e.set(s)}}T([Object(l.c)(`/${C}`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'getAll',null);T([Object(l.c)(`/${C}`),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'getAllEnabled',null);T([Object(l.c)(`/${C}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'getOne',null);T([Object(l.c)(`/${C}/:id`),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'getOneEnabled',null);T([Object(l.c)(`/${C}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'toggle',null);T([Object(l.e)(`/${C}`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'add',null);T([Object(l.e)(`/${C}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'update',null);T([Object(l.b)(`/${C}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),A('design:type',Function),A('design:paramtypes',[l.a,Function]),A('design:returntype',Promise)],x.prototype,'delete',null);var D=n(14),R=n.n(D);const P=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];function r(e){const t=Buffer.isBuffer(e)?e:new Buffer(e);let n=0,r=0,a=0,i=0;const s=o(t.length/5),d=0===t.length%5?s:s+1,u=new Buffer(8*d);while(n<t.length){let e=t[n];if(3<a){i=e&255>>a;a=(a+5)%8;i=i<<a|(n+1<t.length?t[n+1]:0)>>8-a;n++}else{i=31&e>>8-(a+5);a=(a+5)%8;if(0===a)n++}u[r]='ABCDEFGHIJKLMNOPQRSTUVWXYZ234567'.charCodeAt(i);r++}for(n=r;n<u.length;n++)u[n]=61;return u}function a(e){const t=Buffer.isBuffer(e)?e:new Buffer(e);let n=0,r=0,a=0,i=0;const s=new Buffer(Math.ceil(5*t.length/8));for(let o=0;o<t.length;o++){if(61===t[o])break;let e=t[o]-48;if(e<P.length){r=P[e];if(3>=n){n=(n+5)%8;if(0===n){a|=r;s[i]=a;i++;a=0}else a|=255&r<<8-n}else{n=(n+5)%8;a|=255&r>>>n;s[i]=a;i++;a=255&r<<8-n}}else throw new Error('Invalid input - it is not base32 encoded string')}return s.slice(0,i)}class q{constructor({digits:t=6,step:n=30,secret:e,length:r=32}={}){this._digits=u(o(t),1);this._step=u(o(n),1);this._secret=e?e:Object(D.randomBytes)(u(o(r),1)).toString('hex')}hotpToken(e){const t=Number(e).toString(16).padStart(16,'0'),n=a(this.base32Secret).toString('hex'),r=Object(D.createHmac)('sha1',new Buffer(n,'hex')).update(new Buffer(t,'hex')).digest(),i=15&r[r.length-1],s=(127&r[i])<<24|(255&r[i+1])<<16|(255&r[i+2])<<8|255&r[i+3];return String(s%Math.pow(10,this._digits)).padStart(this._digits,'0')}hotpCheck(e,t){const n=this.hotpToken(t);if(1>n.length)return false;return s(e)===s(n)}totpToken(e=0){const t=o(Date.now()/this._step/1e3)+e;return this.hotpToken(t)}totpCheck(e,t=0){const n=[];if(0<t){for(let e=-1*t;e<=t;e++)n.push(s(this.totpToken(e)))}else n.push(s(this.totpToken()));return n.includes(s(e))}get base32Secret(){return r(this._secret).toString().replace(/=/g,'')}}var k=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},N=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const L='auth';class M extends l.g{async auth(e){if(e.session.valid)e.set(204);else e.set(403)}async logout(e){if(e.session.valid){const t=e.session.user,n=e.db,r=new E('sessions').delete().where('owner = $1',String(t.id));e.debug(`=== SQL Query [GET /${L}/logout] ===\n%s`,r);const a=await n.query(r.valueOf());e.debug(`=== SQL Result [GET /${L}/logout] ===\n%s`,a.rows)}e.session.user=null;e.session.id='';e.set(204)}async login(e){const t=await e.request.json();if('object'!==typeof t||!t.email||!t.password){e.set(403);return}const n=e.db,r={text:`SELECT
               *
             FROM
               "users"
             WHERE
               "users"."email" = $1
               AND
               "users"."password" = encode(digest($2, 'sha512'), 'hex')
               AND
               enable`,values:[t.email,t.password]};e.debug(`=== SQL Query [POST /${L}/login] ===\n%s`,r);const a=await n.query(r);e.debug(`=== SQL Result [POST /${L}/login] ===\n%s`,a.rows);if(1!==a.rowCount){e.set(403);return}const i=a.rows[0].totp;if(i){if(!t.otp){e.set(403);return}const n=new q({secret:i});if(!n.totpCheck(t.otp,2)){e.set(403);return}}e.session.user=new S.m(a.rows[0]);if(!e.session.user){e.set(403);return}const s={text:`INSERT INTO
               "sessions" ("owner", "ip")
             VALUES
               ($1, $2)
             RETURNING
               "id"`,values:[String(e.session.user.id),e.session.ip]};e.debug(`=== SQL Query [POST /${L}/login] NEW ===\n%s`,s);const o=await n.query(s);e.debug(`=== SQL Result [POST /${L}/login] NEW ===\n%s`,o.rows);e.session.id=o.rows[0]&&o.rows[0].id||'';e.set({token:e.session.id})}}k([Object(l.c)(`/${L}`),N('design:type',Function),N('design:paramtypes',[l.a,Function]),N('design:returntype',Promise)],M.prototype,'auth',null);k([Object(l.c)(`/${L}/logout`),N('design:type',Function),N('design:paramtypes',[l.a,Function]),N('design:returntype',Promise)],M.prototype,'logout',null);k([Object(l.e)(`/${L}/login`),N('design:type',Function),N('design:paramtypes',[l.a,Function]),N('design:returntype',Promise)],M.prototype,'login',null);var U=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},F=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const Q='currencies',$='currencies';class H extends l.g{async getAll(e){const t=e.db,n=new E($).select(S.c.MainFields);e.debug(`=== SQL Query [GET /${Q}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Q}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.c(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E($).select(S.c.MainFields).where('enable');e.debug(`=== SQL Query [GET /${Q}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Q}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.c(e));e.set(a)}async getOne(e){const t=e.route,n=e.db,r=t.data.symbol.trim();if(!r){e.set(404);return}const a=new E($).select().where('symbol = $1',r);e.debug(`=== SQL Query [GET /${Q}/:symbol] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Q}/:symbol] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.c(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db,r=t.data.symbol.trim();if(!r){e.set(404);return}const a=new E($).select().where('symbol = $1 AND enable',r);e.debug(`=== SQL Query [GET /${Q}/:symbol] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Q}/:symbol] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.c(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db,r=t.data.symbol.trim();if(!r){e.set(404);return}const a={text:`UPDATE "${$}" SET enable = NOT enable WHERE symbol = $1 RETURNING enable`,values:[r]};e.debug(`=== SQL Query [GET /${Q}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${Q}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.c(n),a=new E($).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${Q}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${Q}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.c(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db,r=t.data.symbol.trim();if(!r){e.set(404);return}const a=await e.request.json(),i=new S.c(a),s=new E($).update(i.valueOf()).where('symbol = $1',r).returning();e.debug(`=== SQL Query [POST /${Q}/:symbol] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${Q}/:symbol] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.c(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db,r=t.data.symbol.trim();if(!r){e.set(404);return}const a=new E($).delete().where('symbol = $1',r).returning();e.debug(`=== SQL Query [DELETE /${Q}/:symbol] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${Q}/:symbol] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.c(i.rows[0]);e.set(s)}}U([Object(l.c)(`/${Q}`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'getAll',null);U([Object(l.c)(`/${Q}`),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'getAllEnabled',null);U([Object(l.c)(`/${Q}/:symbol`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'getOne',null);U([Object(l.c)(`/${Q}/:symbol`),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'getOneEnabled',null);U([Object(l.c)(`/${Q}/:symbol/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'toggle',null);U([Object(l.e)(`/${Q}`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'add',null);U([Object(l.e)(`/${Q}/:symbol`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'update',null);U([Object(l.b)(`/${Q}/:symbol`),Object(I.a)([S.j.Administrator,S.j.Su]),F('design:type',Function),F('design:paramtypes',[l.a,Function]),F('design:returntype',Promise)],H.prototype,'delete',null);var G=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},V=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const B='exchanges',z='exchanges';class X extends l.g{async getAll(e){const t=e.db,n=new E(z).select(S.d.MainFields);e.debug(`=== SQL Query [GET /${B}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${B}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.d(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(z).select(S.d.MainFields).where('enable');e.debug(`=== SQL Query [GET /${B}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${B}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.d(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(z).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${B}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${B}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.d(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(z).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${B}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${B}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.d(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${z}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${B}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${B}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.d(n),a=new E(z).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${B}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${B}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.d(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.d(a),s=new E(z).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${B}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${B}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.d(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(z).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${B}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${B}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.d(i.rows[0]);e.set(s)}}G([Object(l.c)(`/${B}`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'getAll',null);G([Object(l.c)(`/${B}`),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'getAllEnabled',null);G([Object(l.c)(`/${B}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'getOne',null);G([Object(l.c)(`/${B}/:id`),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'getOneEnabled',null);G([Object(l.c)(`/${B}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'toggle',null);G([Object(l.e)(`/${B}`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'add',null);G([Object(l.e)(`/${B}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'update',null);G([Object(l.b)(`/${B}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),V('design:type',Function),V('design:paramtypes',[l.a,Function]),V('design:returntype',Promise)],X.prototype,'delete',null);var W=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},Y=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const K='ico',Z='ico';class J extends l.g{async getAll(e){const t=e.db,n=new E(Z).select(S.f.MainFields);e.debug(`=== SQL Query [GET /${K}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${K}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.f(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(Z).select(S.f.MainFields).where('enable');e.debug(`=== SQL Query [GET /${K}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${K}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.f(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Z).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${K}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${K}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.f(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Z).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${K}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${K}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.f(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${Z}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${K}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${K}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.f(n),a=new E(Z).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${K}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${K}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.f(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.f(a),s=new E(Z).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${K}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${K}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.f(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Z).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${K}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${K}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.f(i.rows[0]);e.set(s)}}W([Object(l.c)(`/${K}`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'getAll',null);W([Object(l.c)(`/${K}`),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'getAllEnabled',null);W([Object(l.c)(`/${K}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'getOne',null);W([Object(l.c)(`/${K}/:id`),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'getOneEnabled',null);W([Object(l.c)(`/${K}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'toggle',null);W([Object(l.e)(`/${K}`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'add',null);W([Object(l.e)(`/${K}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'update',null);W([Object(l.b)(`/${K}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Y('design:type',Function),Y('design:paramtypes',[l.a,Function]),Y('design:returntype',Promise)],J.prototype,'delete',null);var ee=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},te=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const ne='markets',re='markets';class ae extends l.g{async getAll(e){const t=e.db,n=new E(re).select(S.g.MainFields);e.debug(`=== SQL Query [GET /${ne}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${ne}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.g(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(re).select(S.g.MainFields).where('enable');e.debug(`=== SQL Query [GET /${ne}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${ne}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.g(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(re).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${ne}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${ne}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.g(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(re).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${ne}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${ne}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.g(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${re}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${ne}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${ne}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.g(n),a=new E(re).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${ne}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${ne}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.g(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.g(a),s=new E(re).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${ne}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${ne}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.g(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(re).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${ne}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${ne}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.g(i.rows[0]);e.set(s)}}ee([Object(l.c)(`/${ne}`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'getAll',null);ee([Object(l.c)(`/${ne}`),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'getAllEnabled',null);ee([Object(l.c)(`/${ne}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'getOne',null);ee([Object(l.c)(`/${ne}/:id`),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'getOneEnabled',null);ee([Object(l.c)(`/${ne}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'toggle',null);ee([Object(l.e)(`/${ne}`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'add',null);ee([Object(l.e)(`/${ne}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'update',null);ee([Object(l.b)(`/${ne}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),te('design:type',Function),te('design:paramtypes',[l.a,Function]),te('design:returntype',Promise)],ae.prototype,'delete',null);var ie=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},se=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const oe='publications',de='publications';class ue extends l.g{async getAll(e){const t=e.db,n=new E(de).select(S.i.MainFields).order({ts:'DESC'});e.debug(`=== SQL Query [GET /${oe}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${oe}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.i(e));e.set(a)}async getByWeigh(e){const t=e.route,n=e.db,r=t.query.weight,a=Array.isArray(r)?r.join(','):r,i=a.split(',').map((e)=>parseInt(e)).filter((e)=>!d(e));if(0===i.length){e.set([]);return}let s=new E(de).select(S.i.MainFields).where(`enable AND ts <= timezone('UTC', now()) AND weight IN (${i.join(',')})`).order({ts:'DESC'});const o=u(parseInt(new Array().concat(t.query.limit).join(''))||0,0);if(0<o)s=s.limit(o);e.debug(`=== SQL Query [GET /${oe}?weight] ===\n%s`,s);const l=await n.query(s.valueOf());e.debug(`=== SQL Result [GET /${oe}?weight] ===\n%s`,l.rows);const p=l.rows.map((e)=>new S.i(e));e.set(p)}async getAllEnabled(e){const t=e.route,n=e.db;let r=new E(de).select(S.i.MainFields).where('enable AND ts <= timezone(\'UTC\', now())').order({ts:'DESC'});const a=u(parseInt(new Array().concat(t.query.limit).join(''))||0,0);if(0<a)r=r.limit(a);e.debug(`=== SQL Query [GET /${oe}] ===\n%s`,r);const i=await n.query(r.valueOf());e.debug(`=== SQL Result [GET /${oe}] ===\n%s`,i.rows);const s=i.rows.map((e)=>new S.i(e));e.set(s)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(de).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.i(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(de).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.i(i.rows[0]);e.set(s)}async getOneByUrl(e){const t=e.route,n=e.db,r=String(t.data.date),a=String(t.data.url),i=new E(de).select().where('ts::date = $1 AND url = $2 AND enable AND ts <= timezone(\'UTC\', now())',r,a);e.debug(`=== SQL Query [GET /${oe}/:date/:url] ===\n%s`,i);const s=await n.query(i.valueOf());e.debug(`=== SQL Result [GET /${oe}/:date/:url] ===\n%s`,s.rows);if(1!==s.rowCount){e.set(404);return}const o=new S.i(s.rows[0]);e.set(o)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${de}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${oe}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${oe}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.i(n),a=new E(de).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${oe}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${oe}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.i(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.i(a),s=new E(de).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${oe}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${oe}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.i(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(de).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.i(i.rows[0]);e.set(s)}}ie([Object(l.c)(`/${oe}`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getAll',null);ie([Object(l.c)(`/${oe}`,'weight'),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getByWeigh',null);ie([Object(l.c)(`/${oe}`),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getAllEnabled',null);ie([Object(l.c)(`/${oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getOne',null);ie([Object(l.c)(`/${oe}/:id`),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getOneEnabled',null);ie([Object(l.c)(`/${oe}/:date/:url`),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'getOneByUrl',null);ie([Object(l.c)(`/${oe}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'toggle',null);ie([Object(l.e)(`/${oe}`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'add',null);ie([Object(l.e)(`/${oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'update',null);ie([Object(l.b)(`/${oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),se('design:type',Function),se('design:paramtypes',[l.a,Function]),se('design:returntype',Promise)],ue.prototype,'delete',null);var le=n(57),pe=n.n(le),ce=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},ge=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const me='raw';class fe extends l.g{async getOne(e){const t=e.route,n=e.db,r=t.data.id;if(!/^[0-9]+&/.test(r)){e.set(404);return}const a=parseInt(r);if(!a){e.set(404);return}e.debug(`=== GET /${me}/:id] LO [%s] ===`,a);const i=new le.LargeObjectManager({pg:n});await n.query('BEGIN');let s;try{const e=await i.openAsync(a,le.LargeObjectManager.READ),t=await e.sizeAsync();s=await e.readAsync(t);await e.closeAsync()}catch(t){await n.query('ROLLBACK');if(p.parseError(t)===p.UNDEFINED_OBJECT){e.set(404);return}e.throw(t);return}await n.query('COMMIT');e.set(s)}async add(e){const t=e.db,n=await e.request.raw();e.debug(`=== PUT [/${me}] LO ===`);const r=new le.LargeObjectManager({pg:t});await t.query('BEGIN');let a;try{a=await r.createAsync();const e=await r.openAsync(a,le.LargeObjectManager.WRITE);await e.writeAsync(n);await e.closeAsync()}catch(n){await t.query('ROLLBACK');e.throw(n);return}await t.query('COMMIT');if(!a){e.throw(new Error('LO empty oid error'));return}e.set({oid:a})}async delete(e){const t=e.route,n=e.db,r=t.data.id;if(!/^[0-9]+$/.test(r)){e.set(404);return}const a=parseInt(r);if(!a){e.set(404);return}e.debug(`=== DELETE /${me}/:id] LO [%s] ===`,a);const i=new le.LargeObjectManager({pg:n});await n.query('BEGIN');try{await i.unlinkAsync(a)}catch(t){await n.query('ROLLBACK');if(p.parseError(t)===p.UNDEFINED_OBJECT){e.set(404);return}e.throw(t);return}await n.query('COMMIT');e.set({oid:a})}}ce([Object(l.c)(`/${me}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),ge('design:type',Function),ge('design:paramtypes',[l.a,Function]),ge('design:returntype',Promise)],fe.prototype,'getOne',null);ce([Object(l.f)(`/${me}`),Object(I.a)([S.j.Administrator,S.j.Su]),ge('design:type',Function),ge('design:paramtypes',[l.a,Function]),ge('design:returntype',Promise)],fe.prototype,'add',null);ce([Object(l.b)(`/${me}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),ge('design:type',Function),ge('design:paramtypes',[l.a,Function]),ge('design:returntype',Promise)],fe.prototype,'delete',null);var ye=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},be=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const he='sections',we='sections';class ve extends l.g{async getAll(e){const t=e.db,n=new E(we).select(S.k.MainFields);e.debug(`=== SQL Query [GET /${he}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${he}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.k(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(we).select(S.k.MainFields).where('enable');e.debug(`=== SQL Query [GET /${he}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${he}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.k(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(we).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${he}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${he}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.k(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(we).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${he}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${he}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.k(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${we}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${he}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${he}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.k(n),a=new E(we).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${he}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${he}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.k(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.k(a),s=new E(we).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${he}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${he}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.k(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(we).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${he}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${he}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.k(i.rows[0]);e.set(s)}}ye([Object(l.c)(`/${he}`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'getAll',null);ye([Object(l.c)(`/${he}`),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'getAllEnabled',null);ye([Object(l.c)(`/${he}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'getOne',null);ye([Object(l.c)(`/${he}/:id`),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'getOneEnabled',null);ye([Object(l.c)(`/${he}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'toggle',null);ye([Object(l.e)(`/${he}`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'add',null);ye([Object(l.e)(`/${he}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'update',null);ye([Object(l.b)(`/${he}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),be('design:type',Function),be('design:paramtypes',[l.a,Function]),be('design:returntype',Promise)],ve.prototype,'delete',null);var _e=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},Ee=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const Oe='statuses',Ie='statuses';class Se extends l.g{async getAll(e){const t=e.db,n=new E(Ie).select(S.l.MainFields).order('title');e.debug(`=== SQL Query [GET /${Oe}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Oe}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.l(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(Ie).select(S.l.MainFields).where('enable').order('title');e.debug(`=== SQL Query [GET /${Oe}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Oe}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.l(e));e.set(a)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Ie).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${Oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.l(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Ie).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${Oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.l(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${Ie}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${Oe}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${Oe}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.l(n),a=new E(Ie).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${Oe}] ===\n%s`,a);const i=await t.query(a.valueOf());e.debug(`=== SQL Result [POST /${Oe}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.l(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.l(a),s=new E(Ie).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${Oe}/:id] ===\n%s`,s);const o=await n.query(s.valueOf());e.debug(`=== SQL Result [POST /${Oe}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.l(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(Ie).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${Oe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${Oe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.l(i.rows[0]);e.set(s)}}_e([Object(l.c)(`/${Oe}`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'getAll',null);_e([Object(l.c)(`/${Oe}`),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'getAllEnabled',null);_e([Object(l.c)(`/${Oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'getOne',null);_e([Object(l.c)(`/${Oe}/:id`),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'getOneEnabled',null);_e([Object(l.c)(`/${Oe}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'toggle',null);_e([Object(l.e)(`/${Oe}`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'add',null);_e([Object(l.e)(`/${Oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'update',null);_e([Object(l.b)(`/${Oe}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ee('design:type',Function),Ee('design:paramtypes',[l.a,Function]),Ee('design:returntype',Promise)],Se.prototype,'delete',null);var Te=n(21),Ae=n.n(Te),Ce=n(7),je=n.n(Ce),xe=n(11),De=n.n(xe);class Re{constructor(e){this.res=e}getHeader(e){let t=this.res.headers[e.toLowerCase()];return Array.isArray(t)?t.join(';'):t}get socket(){return this.res.socket}get ip(){return this.res.connection.remoteAddress||''}get status(){return this.res.statusCode}get type(){let e=this.getHeader('Content-Type');if('string'!==typeof e)return;return e.split(';')[0].trim()}get length(){return~~(this.getHeader('content-length')||'')}async raw(){const e=this.length;return new Promise((t,n)=>{let r=Buffer.alloc(0);const a=()=>{u();n(new Error('Request aborted'))},i=()=>{u();n(new Error('Receive data error'))},s=(e)=>{r=Buffer.concat([r,e])},o=()=>{u();if(0<e&&r.length!==e){n(new Error('Request size did not match content length'))}t(r)},d=()=>{u()};var u=()=>{this.res.removeListener('aborted',a);this.res.removeListener('end',i);this.res.removeListener('data',s);this.res.removeListener('error',o);this.res.removeListener('close',d);this.res.unpipe()};this.res.on('aborted',a);this.res.on('error',i);this.res.on('data',s);this.res.on('end',o);this.res.on('close',d)})}async text(){let e=await this.raw();try{let t=new xe.StringDecoder('utf8');return t.end(e)}catch(e){throw new Error('Receive data is not a UTF8 string')}}async json(){if('application/json'!==this.type){throw new Error('Only application/json data are allowed')}let e=await this.text();try{return JSON.parse(e)}catch(e){throw new Error('Invalid json received')}}valueOf(){return{ip:this.ip,type:this.type,length:this.length}}toJSON(){return this.valueOf()}}class Pe{request(e,t){return new Promise((n,r)=>{const a=(t.pathname||'/')+(t.search&&t.search||''),i=je.a.request({hostname:t.hostname,port:t.port||80,path:a,method:e},(e)=>n(new Re(e)));i.on('error',(e)=>r(e));i.end()})}}var qe=n(59),ke=n.n(qe);class Ne{request(e,t){return new Promise((n,r)=>{const a=(t.pathname||'/')+(t.search&&t.search||''),i=ke.a.request({hostname:t.hostname,port:t.port||443,path:a,method:e},(e)=>n(new Re(e)));i.on('error',(e)=>r(e));i.end()})}}class Le{request(e,t){const n=new Te.URL(t),r=n.protocol.toLowerCase(),a=/^https/.test(r)?new Ne:new Pe;return a.request(e,n)}async get(e){return await this.request('GET',e)}async json(e){const t=await this.get(e),n=await t.json();return n}}var Me=n(4);const Ue=(e)=>`https://graphs.coinmarketcap.com/currencies/${e}/`;class Fe{constructor(){this._http=new Le;this.coins=new Array;this._ids={};this._tickerLastUpdateMoment=0}updateItem(e){const t=this.coins.find((t)=>t.symbol===e.symbol);if(!t){this.coins.push(e);return e}t.update(e);return t}async updateTicker(e){const t=this._tickerLastUpdateMoment+6e4,n=new Date().getTime();if(t>n)return new Array;this._tickerLastUpdateMoment=n;const r=await this._http.json('https://api.coinmarketcap.com/v1/ticker/?limit=0');return r.filter((t)=>e.includes(t.symbol)).map((e)=>{this._ids[e.symbol]=e.id;return{symbol:e.symbol,max:e.max_supply,available:e.available_supply,volume24:e['24h_volume_usd'],price:new S.h({btc:e.price_btc,usd:e.price_usd}),ts:Me.a.fromUnux(e.last_updated)}}).map((e)=>new S.b(e)).map((e)=>this.updateItem(e))}historicalDataItemToHistorical(e,t){return e.map((e)=>new S.e({ts:new Me.a(e[0]),price:new S.h({[t]:e[1]})}))}async updateHistorical(e){const t=this._ids[e.symbol];if(!t)return;const n=Number(e.lastHistorical)||0,r=new Date().getTime();if(n+3.6e6>r)return;const a=Ue(t);console.log('[CoinMarketCap] Upadate Historical [%s] - ',e.symbol,a);const i=await this._http.json(a),s=this.historicalDataItemToHistorical(i.price_btc,'btc'),o=this.historicalDataItemToHistorical(i.price_usd,'usd');e.updateHistorical([...s,...o]);console.log('[CoinMarketCap] Upadate Historical [%s] - complite',e.symbol)}async update(e){let t=await this.updateTicker(e);console.log('[CoinMarketCap] Upadate Tickers [%s] - complite',t.map((e)=>e.symbol).join(','));await Promise.all(t.map((e)=>this.updateHistorical(e)));return t}}var Qe=n(15);async function i(){const e=await Qe.a.connect(),t=new E('currencies').select(['symbol']).where('enable'),n=await e.query(t.valueOf());return n.rows.map((e)=>String(e.symbol))}var $e=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},He=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const Ge='ticker';class Ve extends l.g{constructor({updateInterval:e=6e4}={}){super();this._symbols=new Array;this._coins=new Array;this._sources=new Array;this._updateInterval=6e4;this._updateInterval=e;this._sources.push(new Fe);this.updateLoop()}updateItem(e){const t=new S.b(e),n=this._coins.find((e)=>e.symbol===t.symbol);if(!n){this._coins.push(t);return t}n.update(t);return n}async updateLoop(){console.log('=== Start UpdateLoop ===');const e=await i();if(0>=e.length){setTimeout(()=>this.updateLoop(),this._updateInterval);return}for(let t of this._sources){let n=new Array;try{n=await t.update(e)}catch(e){console.error('Update error',e)}n.forEach((e)=>this.updateItem(e))}setTimeout(()=>this.updateLoop(),this._updateInterval);console.log('=== UpdateLoop complite ===')}async tickers(e){e.set(this._coins)}async ticker(e){const t=e.route,n=String(t.data.symbol).toUpperCase(),r=this._coins.find((e)=>e.symbol===n);if(!r){e.set(404);return}e.set(r)}async historical(e){const t=e.route,n=String(t.data.symbol).toUpperCase(),r=this._coins.find((e)=>e.symbol===n);if(!r){e.set(404);return}e.set(r.historical)}}$e([Object(l.c)(`/${Ge}`),He('design:type',Function),He('design:paramtypes',[l.a,Function]),He('design:returntype',Promise)],Ve.prototype,'tickers',null);$e([Object(l.c)(`/${Ge}/:symbol`),He('design:type',Function),He('design:paramtypes',[l.a,Function]),He('design:returntype',Promise)],Ve.prototype,'ticker',null);$e([Object(l.c)(`/${Ge}/:symbol/historical`),He('design:type',Function),He('design:paramtypes',[l.a,Function]),He('design:returntype',Promise)],Ve.prototype,'historical',null);var Be=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},ze=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const Xe='users',We='users';class Ye extends l.g{async getAllForSU(e){const t=e.db,n=new E(We).select(S.m.MainFields);e.debug(`=== SQL Query [GET /${Xe}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Xe}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.m(e));e.set(a)}async getAll(e){const t=e.db,n=new E(We).select(S.m.AnonymousFields).where('enabled');e.debug(`=== SQL Query [GET /${Xe}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Xe}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.m(e));e.set(a)}async getMe(e){if(!e.session.valid){e.set(403);return}const t=e.db,n=e.session.user,r=new E(We).select().where('id = $1 AND enable',String(n.id));e.debug(`=== SQL Query [GET /${Xe}/me] ===\n%s`,r);const a=await t.query(r.valueOf());e.debug(`=== SQL Result [GET /${Xe}/me] ===\n%s`,a.rows);if(1!==a.rowCount){e.set(403);return}const i=new S.m(a.rows[0]);e.set(i)}async getOneForSU(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(We).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${Xe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Xe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.m(i.rows[0]);e.set(s)}async getOne(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(We).select(S.m.AnonymousFields).where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${Xe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Xe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.m(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE "${We}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[String(r)]};e.debug(`=== SQL Query [GET /${Xe}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${Xe}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async resetOTP(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a={text:`UPDATE
               ${We}
             SET
               totp = encode(digest(uuid_generate_v4()::text, 'sha256'), 'hex')
             WHERE
               id = $1
             RETURNING
               totp`,values:[String(r)]};e.debug(`=== SQL Query [POST /${Xe}/:id/otp] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [POST /${Xe}/:id/otp] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].totp;if(!s){e.set(204);return}const o=new q({secret:s});e.set({secret:o.base32Secret})}async password(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=a.password||a.password1;if(!i){e.set(400,'Password is empty');return}const s={text:`UPDATE ${We} SET password = encode(digest($1, 'sha512'), 'hex') WHERE id = $2 RETURNING id`,values:[i,String(r)]};e.debug(`=== SQL Query [POST /${Xe}/:id/password] ===\n%s`,s);const o=await n.query(s);e.debug(`=== SQL Result [POST /${Xe}/:id/password] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}e.set({success:true})}async add(e){const t=e.db,n=await e.request.json(),r=new S.m(n),a=new E(We).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${Xe}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${Xe}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.m(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=await e.request.json(),i=new S.m(a),s=new E(We).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${Xe}/:id] ===\n%s`,s);let o;try{o=await n.query(s.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${Xe}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.m(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(We).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${Xe}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${Xe}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.m(i.rows[0]);e.set(s)}async getOTP(e){const t=e.route,n=e.db;let r;try{r=new O.a(t.data.id)}catch(t){e.set(400,t.message);return}const a=new E(We).select(['totp']).where('id = $1',String(r));e.debug(`=== SQL Query [GET /${Xe}/:id/otp] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Xe}/:id/otp] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}let s=i.rows[0].totp;if(!s){e.set(204);return}const o=new q({secret:s});e.set({secret:o.base32Secret})}}Be([Object(l.c)(`/${Xe}`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getAllForSU',null);Be([Object(l.c)(`/${Xe}`),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getAll',null);Be([Object(l.c)(`/${Xe}/me`),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getMe',null);Be([Object(l.c)(`/${Xe}/:id`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getOneForSU',null);Be([Object(l.c)(`/${Xe}/:id`),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getOne',null);Be([Object(l.c)(`/${Xe}/:id/toggle`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'toggle',null);Be([Object(l.e)(`/${Xe}/:id/otp`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'resetOTP',null);Be([Object(l.e)(`/${Xe}/:id/password`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'password',null);Be([Object(l.e)(`/${Xe}`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'add',null);Be([Object(l.e)(`/${Xe}/:id`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'update',null);Be([Object(l.b)(`/${Xe}/:id`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'delete',null);Be([Object(l.c)(`/${Xe}/:id/otp`),Object(I.a)([S.j.Su]),ze('design:type',Function),ze('design:paramtypes',[l.a,Function]),ze('design:returntype',Promise)],Ye.prototype,'getOTP',null);var Ke=this&&this.__decorate||function(e,t,n,a){var s=arguments.length,o=3>s?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a,r;if('object'===typeof Reflect&&'function'===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var d=e.length-1;0<=d;d--)if(r=e[d])o=(3>s?r(o):3<s?r(t,n,o):r(t,n))||o;return 3<s&&o&&Object.defineProperty(t,n,o),o},Ze=this&&this.__metadata||function(e,t){if('object'===typeof Reflect&&'function'===typeof Reflect.metadata)return Reflect.metadata(e,t)};const Je='video',et='video';class tt extends l.g{async getAll(e){const t=e.db,n=new E(et).select(S.n.MainFields);e.debug(`=== SQL Query [GET /${Je}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Je}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.n(e));e.set(a)}async getAllEnabled(e){const t=e.db,n=new E(et).select(S.n.MainFields).where('enable');e.debug(`=== SQL Query [GET /${Je}] ===\n%s`,n);const r=await t.query(n.valueOf());e.debug(`=== SQL Result [GET /${Je}] ===\n%s`,r.rows);const a=r.rows.map((e)=>new S.n(e));e.set(a)}async getOne(e){const t=e.route,n=e.db,r=String(t.data.id),a=new E(et).select().where('id = $1',String(r));e.debug(`=== SQL Query [GET /${Je}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Je}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.n(i.rows[0]);e.set(s)}async getOneEnabled(e){const t=e.route,n=e.db,r=String(t.data.id),a=new E(et).select().where('id = $1 AND enable',String(r));e.debug(`=== SQL Query [GET /${Je}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [GET /${Je}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.n(i.rows[0]);e.set(s)}async toggle(e){const t=e.route,n=e.db,r=t.data.id.trim(),a={text:`UPDATE "${et}" SET enable = NOT enable WHERE id = $1 RETURNING enable`,values:[r]};e.debug(`=== SQL Query [GET /${Je}/:id/toggle] ===\n%s`,a);const i=await n.query(a);e.debug(`=== SQL Result [GET /${Je}/:id/toggle] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=i.rows[0].enable;e.set({enable:s})}async add(e){const t=e.db,n=await e.request.json(),r=new S.n(n),a=new E(et).insert(r.valueOf()).returning();e.debug(`=== SQL Query [POST /${Je}] ===\n%s`,a);let i;try{i=await t.query(a.valueOf())}catch(t){if(p.parseError(t)===p.UNIQUE_VIOLATION){e.set(409);return}e.throw(t);return}e.debug(`=== SQL Result [POST /${Je}] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.n(i.rows[0]);e.set(s)}async update(e){const t=e.route,n=e.db,r=String(t.data.id),a=await e.request.json(),i=new S.n(a),s=new E(et).update(i.valueOf()).where('id = $1',String(r)).returning();e.debug(`=== SQL Query [POST /${Je}/:id] ===\n%s`,s);const o=await n.query(s.valueOf());e.debug(`=== SQL Result [POST /${Je}/:id] ===\n%s`,o.rows);if(1!==o.rowCount){e.set(404);return}const d=new S.n(o.rows[0]);e.set(d)}async delete(e){const t=e.route,n=e.db,r=String(t.data.id),a=new E(et).delete().where('id = $1',String(r)).returning();e.debug(`=== SQL Query [DELETE /${Je}/:id] ===\n%s`,a);const i=await n.query(a.valueOf());e.debug(`=== SQL Result [DELETE /${Je}/:id] ===\n%s`,i.rows);if(1!==i.rowCount){e.set(404);return}const s=new S.n(i.rows[0]);e.set(s)}}Ke([Object(l.c)(`/${Je}`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'getAll',null);Ke([Object(l.c)(`/${Je}`),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'getAllEnabled',null);Ke([Object(l.c)(`/${Je}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'getOne',null);Ke([Object(l.c)(`/${Je}/:id`),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'getOneEnabled',null);Ke([Object(l.c)(`/${Je}/:id/toggle`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'toggle',null);Ke([Object(l.e)(`/${Je}`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'add',null);Ke([Object(l.e)(`/${Je}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'update',null);Ke([Object(l.b)(`/${Je}/:id`),Object(I.a)([S.j.Administrator,S.j.Su]),Ze('design:type',Function),Ze('design:paramtypes',[l.a,Function]),Ze('design:returntype',Promise)],tt.prototype,'delete',null);n.d(t,'a',function(){return x});n.d(t,'b',function(){return M});n.d(t,'c',function(){return H});n.d(t,'d',function(){return X});n.d(t,'e',function(){return J});n.d(t,'f',function(){return ae});n.d(t,'g',function(){return ue});n.d(t,'h',function(){return fe});n.d(t,'i',function(){return ve});n.d(t,'j',function(){return Se});n.d(t,'k',function(){return Ve});n.d(t,'l',function(){return Ye});n.d(t,'m',function(){return tt})},function(e,t,n){'use strict';t.LargeObjectManager=n(58);t.LargeObject=n(26);t.ReadStream=n(27);t.WriteStream=n(28)},function(e,t,n){'use strict';var i=n(25),s=n(26);function r(e){return function(t,n){e.query(t).then(function(e){n(null,{rows:e})}).catch(function(e){n(e)})}}function a(e){if('function'===typeof e.query){var t=e;this._query=t.query.bind(t)}else if(e.pg){var t=e.pg;this._query=t.query.bind(t)}else if(e.pgPromise){var n=e.pgPromise;this._query=r(n)}else{throw Error('Either the `pg` or `pgPromise` option must be given')}}a.WRITE=131072;a.READ=262144;a.READWRITE=393216;a.prototype.open=function(e,t,n){if(!e){throw Error('Illegal Argument')}this._query({name:'npg_lo_open',text:'SELECT lo_open($1, $2) AS fd',values:[e,t]},function(t,r){if(t)return n(t);var a=r.rows[0].fd;n(null,new s(this._query,e,a))}.bind(this))};a.prototype.openAsync=function(e,t){return i(function(n){this.open(e,t,n)},this)};a.prototype.create=function(e){this._query({name:'npg_lo_creat',text:'SELECT lo_creat($1) AS oid',values:[a.READWRITE]},function(t,n){if(t)return e(t);var r=n.rows[0].oid;e(null,r)})};a.prototype.createAsync=function(){return i(function(e){this.create(e)},this)};a.prototype.unlink=function(e,t){if(!e){throw Error('Illegal Argument')}this._query({name:'npg_lo_unlink',text:'SELECT lo_unlink($1) as ok',values:[e]},t?function(e){t(e)}:undefined)};a.prototype.unlinkAsync=function(e){return i(function(t){this.unlink(e,t)},this)};a.prototype.openAndReadableStream=function(e,t,n){if('function'===typeof t){n=t;t=undefined}this.open(e,a.READ,function(e,r){if(e)return n(e);r.size(function(e,a){if(e)return n(e);var i=r.getReadableStream(t);i.on('end',function(){r.close(function(e){if(e){console.error('Warning: closing a large object failed:',e)}})});n(null,a,i)})})};a.prototype.openAndReadableStreamAsync=function(e,t){return i(function(n){this.openAndReadableStream(e,t,n)},this,{twoArgs:true})};a.prototype.createAndWritableStream=function(e,t){if('function'===typeof e){t=e;e=undefined}var n=this;n.create(function(r,i){if(r)return t(r);n.open(i,a.WRITE,function(n,r){if(n)return t(n);var a=r.getWritableStream(e);a.on('finish',function(){r.close(function(e){if(e){console.error('Warning: closing a large object failed:',e)}})});t(null,i,a)})})};a.prototype.createAndWritableStreamAsync=function(e){return i(function(t){this.createAndWritableStream(e,t)},this,{twoArgs:true})};e.exports=a},function(e){e.exports=require('https')},,,,,function(e,t,n){e.exports=n(65)},function(e,t,n){'use strict';Object.defineProperty(t,'__esModule',{value:true});var r=n(1),a=n(56);process.env.TZ='UTC';new r.h(new a.k())}]);